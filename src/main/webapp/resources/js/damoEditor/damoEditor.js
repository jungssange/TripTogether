/**
 * damo EDITOR v1.0
 * Copyright (c) 2016, Damonet Inc. All rights reserved.
 */


var ReleaseVer="20160731004";var C_PX="px";var damoUtil={isIE:navigator.appVersion.indexOf("MSIE")>-1,isChrome:/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),isEdge:window.navigator.userAgent.indexOf("Edge/")>0,detectIE:function(){var a=window.navigator.userAgent;if(a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0){return true}return false},isMobile:function(){if(/Android|webOS|iPhone|iPad|iPod|pocket|psp|kindle|avantgo|blazer|midori|Palm|maemo|plucker|phone|BlackBerry|symbian|IEMobile|mobile|ZuneWP7|Windows Phone|Opera Mini/i.test(navigator.userAgent)){return true}return false},getNodeWidth:null,getElm:function(a){return document.getElementById(a)},createElement:function(a,c,f,b,e,d){var g=document.createElement(a);if(c){c.appendChild(g)}if(f){this.addClass(g,f)}if(b){this.addEvent(g,b,e,d)}return g},removeAllChild:function(a){while(a.firstChild){a.removeChild(a.firstChild)}},addEvent:function(c,a,d,b){if(c.addEventListener){c.addEventListener(a,d,false);if(b){c.addEventListener("mousedown",this.preventEvent,false)}}else{c.attachEvent("on"+a,d);if(b){c.attachEvent("onmousedown"+a,this.preventEvent)}}},removeEvent:function(b,a,c){if(b.removeEventListener){b.removeEventListener(a,c)}else{if(x.detachEvent){b.detachEvent("on"+a,c)}}},addEventByClass:function(d,a,e,c){var b=document.getElementsByClassName(d);if(b[0]){this.addEvent(b[0],a,e,c)}},preventEvent:function(b){var a=b||window.event;if(a.preventDefault&&a.stopPropagation){a.preventDefault();a.stopPropagation()}return false},hasClass:function(b,a){return b.className.indexOf(a)>0},addClass:function(b,a){if(!this.hasClass(b,a)){if(b.className!==""){b.className+=" "}b.className+=a}},toggleClass:function(b,a){if(this.hasClass(b,a)){this.removeClass(b,a)}else{this.addClass(b,a)}},removeClass:function(b,a){b.className=b.className.replace(a,"")},setStyle:function(d,c){var a=d.style;for(var b in c){a[b]=c[b]}},setStyleNremoveA:function(d,c){var a=d.style;for(var b in c){a[b]=c[b];d.removeAttribute(b)}},getStyle:function(b,a){if(document.defaultView&&document.defaultView.getComputedStyle){return document.defaultView.getComputedStyle(b,null).getPropertyValue(a)}else{if(b.currentStyle){return b.currentStyle[a]}}return null},getStyleI:function(b,a){return parseInt(this.getStyle(b,a))},getStyleA:function(b,a){if(b.getAttribute(a)){return b.getAttribute(a)}if(b.style[a]){return b.style[a]}return this.getStyle(b,a)},getStyleAI:function(c,b){var a=this.getStyleA(c,b);if(a){return parseInt(a)}return""},setSelection:function(c,a,b,d){if(!c){return}if(window.getSelection){a.setStart(b,d);a.collapse(true);c.removeAllRanges();c.addRange(a)}else{a.select()}c=a=null},setSelection2:function(c,a,b){if(!a){return}if(window.getSelection){a.setStartBefore(b);a.setEndAfter(b);c.removeAllRanges();c.addRange(a)}else{a.select()}c=a=null},setSelectionControl:function(d){if(document.body.createControlRange){var b=document.body.createControlRange();b.add(d);b.select()}else{var c=this.getSelection();var a=this.getRange();this.setSelection2(c,a,d)}},setSelectText:function(e,d,c,b){if(!c&&c!==0){c=0;if(d.data){b=d.data.length}}var a=document.createRange();a.setStart(d,c);a.setEnd(d,b);e.removeAllRanges();e.addRange(a)},getSelection:function(){return(window.getSelection)?window.getSelection():document.selection},getRange:function(){var b,a;if(window.getSelection){b=window.getSelection();if(b.getRangeAt&&b.rangeCount){a=b.getRangeAt(0);return a}}else{if(document.selection&&document.selection.type!=="Control"){return document.selection.createRange()}}},getRangeCreate:function(){var a=this.getRange();if(!a){a=document.createRange()}return a},getElementFromSibling:function(a){if(!a){return}if(a.collapsed){return a.startContainer}var b=a.startContainer;if(!b){return null}while(b&&b.nodeType===3){b=b.nextSibling}return b},getElementFromHierarchy:function(){var a=damoUtil.getRange();if(!a){return}if(a.collapsed){return a.startContainer}if(a.startContainer&&a.startContainer.firstChild){a=a.startContainer.firstChild}else{if(a.endContainer&&a.endContainer.firstChild){a=a.endContainer.firstChild}else{a=a.startContainer}}while(a&&a.nodeType===3){a=a.parentNode}return a},onlyNumber:function(c){var b=c||window.event;var a=window.event?b.keyCode:b.which;if((b.shiftKey===false)&&((a>47&&a<58)||(a>95&&a<106)||a===35||a===36||a===37||a===39||a===8||a===46||a===13)){return true}else{b.preventDefault()}},parseInt:function(a){if(!a){return 0}return parseInt(a)},loadScript:function(a,c){var b=document.createElement("script");b.type="text/javascript";if(c){if(b.readyState){b.onreadystatechange=function(){if(b.readyState=="loaded"||b.readyState=="complete"){b.onreadystatechange=null;c()}}}else{b.onload=function(){c()}}}b.src=damoScriptPath+a;if(document.head){document.head.appendChild(b)}else{document.getElementsByTagName("head")[0].appendChild(b)}return b},toArray:function(b){var c=b.length,a=new Array(c);while(c--){a[c]=b[c]}return a},getBlankChar:function(){var a="<BR/>";if(damoUtil.isIE){a="&nbsp;"}return a},getElementPosition:function(d){var b=0;var a=0;var c="";while(d){c=damoUtil.getStyle(d,"position");if(c!=="static"){break}b+=d.offsetTop;a+=d.offsetLeft;d=d.offsetParent}return{top:b,left:a}},getElementPosition2:function(c){var b=0;var a=0;while(c){b+=c.offsetTop;a+=c.offsetLeft;c=c.offsetParent}return{top:b,left:a}},protectFromXSS:function(editor,xssOption){var tags=xssOption.removeTag.split(",");for(var i=0;i<tags.length;i++){var tagList=editor.getElementsByTagName(tags[i]);for(var j=0;j<tagList.length;j++){tagList[j].parentNode.removeChild(tagList[j])}}var eles=editor.getElementsByTagName("IMG");for(var i=0;i<eles.length;i++){eles[i].removeAttribute("onerror")}var html=editor.innerHTML;if(xssOption.removeEvent==="all"){html=html.replace(/<[^>]+/g,function(match){return match.replace(/ on\w+[= ]*["\'][^"]*["\']/g,"")})}else{if(xssOption.removeEvent!==""){var evlist=xssOption.removeEvent.split(",");for(var i=0;i<evlist.length;i++){html=html.replace(/<[^>]+/g,function(match){return match.replace(eval("/"+evlist[i]+'[= ]*["\'][^"]*["\']/gi'),"")})}}}editor.innerHTML=html},removeLayoutCSS:function(a){a=a.replace(/[\r|\n|\t|\v|\f]/g,"");a=a.replace(/<\/p>/gi,"</p>\n");a=a.replace(/<br(\s)*\/?>/gi,"<br/>\n");return a.replace(new RegExp("damoLayoutDot","g"),"")},inputCheck:function(a,b){if(a.value===""){alert(b);a.focus();return false}return true}};var rangeUtil={getAllTagList:function(d,b){if(!d){return[]}if(d.collapsed){var c=this.findTag(d.startContainer,b);return(c)?[c]:[]}var e=this.getAllNodeList(d);var j=[];for(var g=0;g<e.length;g++){var h=e[g];if(h.nodeName.match(b)){j.push(h)}else{var f=this.findTag(h,b);if(f){j.push(f)}}}return j},findTag:function(b,a){if(!b){return null}var c=b;while(c){if(c.className==="editor"){return null}if(c.nodeName.match(a)){return c}c=c.nextSibling}c=b;if(c.firstChild){c=c.firstChild}do{if(c.className==="editor"){return null}if(c&&c.nodeName&&c.nodeName.match(a)){return c}c=c.parentNode}while(c);return null},findTags:function(c,a){var d=c;var b=[];while(d){if(d.className==="editor"){return null}if(d.nodeName.match(a)){b.push(d)}d=d.nextSibling}if(b.length>0){return b}d=c;if(d.firstChild){d=d.firstChild}do{if(d.className==="editor"){return null}if(d&&d.nodeName&&d.nodeName.match(a)){return this.findTags(d,a)}d=d.parentNode}while(d);return null},findTagInPath:function(b,a){if(!b){return null}if(b.firstChild){b=b.firstChild}do{if(b.className==="editor"){return null}if(b&&b.nodeName&&b.nodeName.match(a)){return b}b=b.parentNode}while(b);return null},findTagInPathByClass:function(a,b){do{if(a.className===b){return a}a=a.parentNode}while(a);return null},findElementByTag:function(a){var b=damoUtil.getRange();return this.findTag(b.startContainer,a)},getSpanList:function(b){if(!b){return[]}if(b.collapsed){var f=document.createElement("SPAN");f.appendChild(b.extractContents());b.deleteContents();b.insertNode(f);return[f]}var c=this.getAllNodeList(b);var e=[];for(var d=0;d<c.length;d++){var g=c[d];if(!g||g.nodeType!==3||g.data===null){if(g.tagName==="SPAN"){e.push(g)}continue}if(g.data==="\n"||g.data==="\n"){continue}var a=g.parentNode;if(e.indexOf(a)>-1){continue}if(a.tagName==="SPAN"&a.innerHTML===g.data){e.push(a);continue}var f=document.createElement("SPAN");a.insertBefore(f,g);f.appendChild(g);e.push(f)}var h=damoUtil.getSelection();h.removeAllRanges();if(e.length>0){b.setStartBefore(e[0]);b.setEndAfter(e[e.length-1]);h.addRange(b)}return e},getAllNodeList:function(a){var b=this.startContainer(a);this.endNode=this.endContainer(a);if(!b||!this.endNode){return[]}if(b.nodeName==="SPAN"&this.endNode.nodeName==="#text"){if(b.innerHTML.indexOf(this.endNode.data)===0){return[this.endNode]}}this.nodeList=[];this.extractNodes(b);return this.nodeList},extractNodes:function(a){if(this.extractChildNodes(a)){return}while(!a.nextSibling){if(!(a=a.parentNode)){return}this.nodeList.push(a);if(a===this.endNode){return}}return this.extractNodes(a.nextSibling)},extractChildNodes:function(b){if(!b){return false}this.nodeList.push(b);var a=b.firstChild;while(a){if(a&b.innerHTML===a.data){a=a.nextSibling;continue}if(this.extractChildNodes(a)){return true}a=a.nextSibling}if(b===this.endNode){return true}return false},searchNext:function(a){if(!a||a.tagName==="BODY"){return document.body}if(a.nextSibling){return a.nextSibling}return this.searchNext(a.parentNode)},searchPrevious:function(a){if(!a||a.tagName==="BODY"){return document.body}if(a.previousSibling){return a.previousSibling}return this.searchPrevious(a.parentNode)},startContainer:function(c){if(!c){return null}if(c.startContainer.nodeType===3){if(c.startOffset<c.startContainer.nodeValue.length){var b=c.startContainer.splitText(c.startOffset);if(c.startContainer===c.endContainer){c.endOffset-=c.startOffset;c.endContainer=b}}if(c.startOffset>=c.startContainer.nodeValue.length){return this.searchNext(c.startContainer)}return c.startContainer}else{if(c.startOffset>=c.startContainer.childNodes.length){return this.searchNext(c.startContainer)}return this.childNodes2Array(c.startContainer)[c.startOffset]}},endContainer:function(a){if(a.endContainer.nodeType===3){if(a.endOffset<a.endContainer.nodeValue.length){a.endContainer.splitText(a.endOffset)}if(a.endOffset===0){return this.searchPrevious(a.endContainer)}return a.endContainer}else{if(a.endOffset===0){return this.searchPrevious(a.endContainer)}return this.childNodes2Array(a.endContainer)[a.endOffset-1]}},childNodes2Array:function(a){if(!a){return[]}var b=[];a=a.firstChild;while(a){b.push(a);a=a.nextSibling}return b},execCommand:function(f,e,c){var a=damoUtil.getRange();if((!a||a.collapsed)&&c.length>0){var d=damoUtil.getSelection();a=damoUtil.getRangeCreate();for(var b=0;b<c.length;b++){damoUtil.setSelection2(d,a,c[b]);document.execCommand(f,false,e)}a.collapse(false);d.removeAllRanges()}else{if((!a||a.collapsed)&&(f==="subscript"||f==="superscript")){return false}document.execCommand(f,false,e)}return true}};Function.prototype.closure=function(){var c=this,a=arguments[0],b=arguments[1];if(b){b=[b]}return function(){return c.apply(a,(b)?b:[a])}};Function.prototype.closureListener=function(){var a=this,b=damoUtil.toArray(arguments),c=b.shift();return function(d){d=d||window.event;if(d.target){var e=d.target}else{var e=d.srcElement}return a.apply(c,[d,e].concat(b))}};function damoFileUpload(c,d,e){var b=document.createElement("form");b.action=d;b.method="post";b.enctype="multipart/form-data";b.style.display="none";b.target="damoiframe";document.body.appendChild(b);b.appendChild(c);var a=document.createElement("iframe");a.src="javascript:false;";a.name="damoiframe";a.style.display="none";document.body.appendChild(a);a.onload=function(){var h=this.contentWindow?this.contentWindow.document:(this.contentDocument?this.contentDocument:this.document);var g=h.documentElement?h.documentElement:h.body;var f=g.textContent?g.textContent:g.innerText;e(f);document.body.removeChild(b);document.body.removeChild(a)};b.submit()}function damoFileUploadByAjax(b,c,f,a){var d=new FormData();d.append("damoImgFile",b.files[0]);var e=new XMLHttpRequest();e.open("POST",c,true);e.setRequestHeader("Cache-Control","no-cache");if(a){e.upload.onprogress=function(g){damoUtil.setStyle(a,{width:(g.loaded/g.total*100)+"%"});console.log(g.loaded/g.total)}}e.onload=function(g){var h=e.responseText;f(h.replace(/[\r\n]/g,""))};e.send(d)}function damoAjax(b){var a=null;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}}}}if(!a){alert("Cannot create an XMLHTTP instance");return false}a.onreadystatechange=function(){if(a.readyState!==4){return}if(a.status===200){if(b.done){b.done(a.responseText)}}else{alert("There was a problem with the request.")}};a.open("POST",b.url);a.send(b.data)}var damoScriptPath=document.querySelector('script[src$="damoEditor.js"]').getAttribute("src");damoScriptPath=damoScriptPath.replace("damoEditor.js","");damoUtil.loadScript("ext/colorpicker.min.js");var editorConfig={buttons:{},iconsize:24,filesize:20*1000*1000};editorConfig.buttons.newdoc={icon:1,command:null,title:"새문서",clickEvent:damoNewClick,shortcut:"N"};editorConfig.buttons.save={icon:2,command:null,title:"저장",clickEvent:damoSaveClick};editorConfig.buttons.print={icon:3,command:null,title:"출력",clickEvent:damoPrintClick,shortcut:"P"};editorConfig.buttons.undo={icon:4,command:"undo",title:"되돌리기"};editorConfig.buttons.redo={icon:5,command:"redo",title:"다시실행"};editorConfig.buttons.copy={icon:6,command:"copy",title:"복사하기"};editorConfig.buttons.cut={icon:7,command:"cut",title:"잘라내기"};editorConfig.buttons.paste={icon:8,command:"paste",title:"붙여넣기",clickEvent:damoPasteClick};editorConfig.buttons.hr={icon:13,command:"insertHorizontalRule",title:"수평선"};editorConfig.buttons.bold={icon:14,command:"Bold",title:"굵게",tags:"^B$|STRONG",css:{"font-weight":"bold"},shortcut:"B"};editorConfig.buttons.italic={icon:16,command:"Italic",title:"기울임꼴",tags:"EM|^I$",css:{"font-style":"italic"},shortcut:"I"};editorConfig.buttons.underline={icon:15,command:"Underline",title:"하단선",tags:"^U$",css:{"text-decoration":"underline"},shortcut:"U"};editorConfig.buttons.strikethrough={icon:17,command:"strikeThrough",title:"중앙선",tags:"STRIKE",css:{"text-decoration":"line-through"}};editorConfig.buttons.subscript={icon:21,command:"subscript",title:"아래첨자",tags:"SUB"};editorConfig.buttons.superscript={icon:20,command:"superscript",title:"윗첨자",tags:"SUP"};editorConfig.buttons.left={icon:22,command:"justifyleft",title:"왼쪽 맞춤",group:"a",clickClass:damoAlignButtonEvent};editorConfig.buttons.center={icon:23,command:"justifycenter",title:"가운데 맞춤",group:"a",clickClass:damoAlignButtonEvent};editorConfig.buttons.right={icon:24,command:"justifyright",title:"오른쪽 맞춤",group:"a",clickClass:damoAlignButtonEvent};editorConfig.buttons.justify={icon:25,command:"justifyfull",title:"양쪽 맞춤",group:"a",clickClass:damoAlignButtonEvent};editorConfig.buttons.ol={icon:26,command:"insertorderedlist",title:"번호 매기기",tags:"OL",group:"b",clickClass:damoOrderButtonEvent};editorConfig.buttons.ul={icon:27,command:"insertunorderedlist",title:"글머리 기호",tags:"UL",group:"b",clickClass:damoOrderButtonEvent};editorConfig.buttons.outdent={icon:28,command:"outdent",title:"내어쓰기",clickEvent:damoOutdentClick};editorConfig.buttons.indent={icon:29,command:"indent",title:"들여쓰기",clickEvent:damoIndentClick,shortcut:"T"};editorConfig.buttons.removeformat={icon:30,command:"removeformat",title:"형식제거"};editorConfig.buttons.image={icon:9,command:"image",title:"이미지",dialogHandler:damoDialogImage};editorConfig.buttons.link={icon:10,command:"link",title:"링크",dialogHandler:damoDialogLink,shortcut:"L"};editorConfig.buttons.table={icon:11,command:"table",title:"테이블",clickClass:damoButtonTable};editorConfig.buttons.specialChar={icon:12,command:"sChar",title:"특수기호",dialogHandler:damoDialogChar};editorConfig.buttons.emoticon={icon:46,command:"emoticon",title:"이모티콘",dialogHandler:damoDialogEmoticon};editorConfig.buttons.find={icon:44,command:"find",title:"찾기&바꾸기",dialogHandler:damoDialogFind,shortcut:"F"};editorConfig.buttons.layout={icon:45,command:"layout",title:"레이아웃",dialogHandler:damoDialogLayout};editorConfig.buttons.forecolor={icon:18,command:"forecolor",title:"글자색",selectHandler:damoSelectBoxColor};editorConfig.buttons.backcolor={icon:19,command:"background-color",title:"글자배경색",selectHandler:damoSelectBoxColor};editorConfig.buttons.fontfamily={command:"fontname",title:"글꼴",selectHandler:damoSelectBoxFontname};editorConfig.buttons.fontsize={command:"fontsize",title:"글자크기",selectHandler:damoSelectBoxFontsize};editorConfig.buttons.fontformat={command:"formatBlock",title:"글자서식",selectHandler:damoSelectBoxFontformat};editorConfig.buttons.lineheight={icon:52,command:"lineheight",title:"줄간격",selectHandler:damoSelectButtonLineheight};editorConfig.buttons.bgcolor4td={icon:51,command:"bgcolor4td",title:"셀배경색",selectHandler:damoSelectBoxColor4td};editorConfig.buttons.documentBG={icon:53,command:null,title:"문서배경",dialogHandler:damoDialogDocument};editorConfig.buttons.externalMedia={icon:50,command:null,title:"외부동영상",dialogHandler:damoDialogExternalMedia};editorConfig.buttons.mediaFile={icon:55,command:null,title:"동영상파일",dialogHandler:damoDialogMedia};editorConfig.buttons.media={icon:50,command:null,title:"동영상",selectHandler:damoSelectBoxMedia};editorConfig.buttons.align={icon:22,command:null,title:"정렬",selectHandler:damoSelectBoxAlign};var DAMO_GAP="gap";var DAMO_BLANK="blank";var DAMO_BLANKSMALL="blankSmall";editorConfig.defaultButtons1=["newdoc","save","print","undo","redo","copy","cut","paste","find","layout","image","link","table","specialChar","emoticon","hr","left","center","right","justify","ol","ul","indent","outdent","<br>","fontsize","fontfamily","fontformat","lineheight","bold","italic","underline","strikethrough","subscript","superscript","removeformat","forecolor","backcolor"];editorConfig.defaultButtons=[["fontfamily","fontsize","fontformat",DAMO_GAP,"undo","copy","paste",DAMO_GAP,"ul","ol","subscript","superscript","indent",DAMO_BLANKSMALL,"outdent",DAMO_BLANKSMALL,DAMO_GAP,"link","table","image","media",DAMO_GAP,"save","print"],[{group:["bold","italic","underline","strikethrough"]},{group:["removeformat","forecolor","backcolor"]},DAMO_GAP,"redo","cut","find",DAMO_GAP,"left","center","right","justify","lineheight","bgcolor4td",DAMO_GAP,"specialChar","hr","emoticon","documentBG",DAMO_BLANKSMALL,DAMO_GAP,"newdoc","layout"]];editorConfig.mobileButtons=[["fontfamily","fontsize","bold","italic","underline","strikethrough","removeformat","forecolor","backcolor","align","lineheight","image","emoticon"]];editorConfig.xss={used:true,removeTag:"script,iframe,object,applet,embed,form",removeEvent:"all"};var dContextMenu=null,damoTableEditor=null;var damoEditors={activeEditor:null,editors:[],addEditor:function(a,b){this.editors.push({editor:a,damo:b})},findEditor:function(c){var b=this.editors;for(var a=0;a<b.length;a++){if(b[a].editor===c){return b[a].damo}}},findDamoEditorInPath:function(b){var a=rangeUtil.findTagInPathByClass(b,"editor");if(!a||a.contentEditable==="inherit"){return null}return damoEditors.findEditor(a)}};var DAMO_Language=[];function DamoEditor(b,a){this.contentEditor=damoUtil.getElm(b);this.contentEditor.style.display="none";this.options=a||{};this.options.language=this.options.language||"ko";this.options.xss=this.options.xss||editorConfig.xss;if(this.options.xss.used===undefined){this.options.xss.used=editorConfig.xss.used}if(this.options.xss.removeTag===undefined){this.options.xss.removeTag=editorConfig.xss.removeTag}if(this.options.xss.removeEvent===undefined){this.options.xss.removeEvent=editorConfig.xss.removeEvent}if(this.options.filesize===undefined){this.options.filesize=editorConfig.filesize}if(this.options.useMobile===undefined){this.options.useMobile=true}if(this.options.plugins){if(this.options.plugins){this.imageEditor=this.options.plugins.imageEditor}}this.range=null;this.damoEditor=damoUtil.createElement("div",null,"damoEditor");this.contentEditor.parentNode.insertBefore(this.damoEditor,this.contentEditor);this.toolbar=damoUtil.createElement("div",this.damoEditor,"toolbar","mousedown",damoUtil.preventEvent);this.editor=damoUtil.createElement("div",this.damoEditor,"editor");var c=this.contentEditor.value;if(c.trim()===""){this.clearDocument()}else{this.setHtmlContent(c)}this.editor.contentEditable=true;damoUtil.setStyle(this.damoEditor,{width:this.contentEditor.style.width||"750px"});damoUtil.setStyle(this.editor,{height:this.contentEditor.style.height||"350px"});damoEditors.addEditor(this.editor,this);damoUtil.loadScript("lang/"+this.options.language+".js",this.init.closure(this))}DamoEditor.prototype.init=function(){this.DamoMessage=DAMO_Language[this.options.language];var k=this.editor.getBoundingClientRect();this.position={left:k.left,top:k.top};var g=null,d=null;if(this.options.buttons){g=this.options.buttons}else{g=editorConfig.defaultButtons}var b=new RegExp(DAMO_GAP+"|"+DAMO_BLANK+"|"+DAMO_BLANKSMALL);this.extendButton=[];this.tagButtonList=[];this.buttonList=[];this.shortcutList={};var h=null,e=null;this.makeButon=function(a,l){editorConfig.buttons[a].title=this.DamoMessage.buttons[a];if(editorConfig.buttons[a].selectHandler){d=new editorConfig.buttons[a].selectHandler().init(this,editorConfig.buttons[a]);if(l){d.changeToGroup()}}else{d=new DamoButton(this,editorConfig.buttons[a],l)}this.buttonList.push(d);if(editorConfig.buttons[a].tags){this.tagButtonList.push(d)}else{if(a==="undo"){h=d}else{if(a==="redo"){e=d}else{if(editorConfig.buttons[a].shortcut){this.shortcutList[editorConfig.buttons[a].shortcut.charCodeAt()]=d.button}}}}};var j=this.toolbar;this.makeButons=function(o,q){var n=damoUtil.createElement("div",j,"subbar");n.id=q;this.toolbar=n;for(var m in o){var a=o[m];if(a==="<br>"){damoUtil.createElement("br",this.toolbar);continue}if(b.test(a)){var r=damoUtil.createElement("div",this.toolbar,a);continue}if(typeof a!=="string"){var p=a.group;var r=damoUtil.createElement("div",this.toolbar);damoUtil.setStyle(r,{display:"inline-block",width:"2px"});for(var l in p){this.makeButon(p[l],true)}r=damoUtil.createElement("div",this.toolbar);damoUtil.setStyle(r,{display:"inline-block",width:"2px"})}else{this.makeButon(a)}}};for(var f in g){this.makeButons(g[f],f)}this.toolbar=j;this.morePn=damoUtil.createElement("div",this.toolbar,"morePn");var c=damoUtil.createElement("div",this.morePn,"moreBtn");this.overflowBar=damoUtil.createElement("div",this.morePn,"overflowBar");damoUtil.setStyle(this.overflowBar,{visibility:"hidden"});damoUtil.addEvent(c,"click",this.damoResizeMorebtnClick.closureListener(this));if(damoUtil.detectIE()){damoUtil.getNodeWidth=function(a){return damoUtil.getStyleI(a,"width")+damoUtil.getStyleI(a,"border-left-width")*2+damoUtil.getStyleI(a,"padding-left")*2+damoUtil.getStyleI(a,"margin-left")+damoUtil.getStyleI(a,"margin-right")}}else{damoUtil.getNodeWidth=function(l){var a=damoUtil.getStyleI(l,"width")+damoUtil.getStyleI(l,"margin-left")+damoUtil.getStyleI(l,"margin-right");if(l.nodeName!=="BUTTON"){a+=damoUtil.getStyleI(l,"border-left-width")*2}return a}}this.undoManager=new UndoManager(h,e,this);damoUtil.addEvent(this.editor,"mouseup",this.editorMousedown.closureListener(this));damoUtil.addEvent(this.editor,"keydown",this.editorKeydown.closureListener(this));damoUtil.addEvent(this.editor,"keyup",this.editorKeyup.closureListener(this));damoUtil.addEvent(this.editor,"blur",this.editorBlur.closure(this));damoUtil.addEvent(this.editor,"focus",this.editorFocus.closure(this));damoUtil.addEvent(this.editor,"paste",this.damoPasteEvent.closureListener(this));damoUtil.addEvent(this.editor,"dragend",this.damoDropEvent.closureListener(this));damoUtil.addEvent(window,"resize",this.damoResize.closureListener(this));if(this.options.useEditMode===undefined||this.options.useEditMode===true){this.setEditorMode()}if(!damoTableEditor){damoTableEditor=new TableEditor()}if(!dContextMenu){dContextMenu=new DamoContextMenu();dContextMenu.init(damoTableEditor)}if(this.options.colors){this.setToolbarBgColor(this.toolbar,this.damoEditor);this.setToolbarBgColor(this.overflowBar,this.overflowBar)}this.damoResize();return this};DamoEditor.prototype.setToolbarBgColor=function(b,a){damoUtil.setStyle(a,{"border-color":this.options.colors.editorBorder});damoUtil.setStyle(b,{"border-bottom-color":this.options.colors.editorBorder});damoUtil.setStyle(b,{background:this.options.colors.toolbarStart});damoUtil.setStyle(b,{background:"linear-gradient(to bottom, "+this.options.colors.toolbarStart+" 0%, "+this.options.colors.toolbarEnd+" 100%"});damoUtil.setStyle(b,{background:"-moz-linear-gradient(top, "+this.options.colors.toolbarStart+" 0%, "+this.options.colors.toolbarEnd+" 100%"});damoUtil.setStyle(b,{background:"-webkit-linear-gradient(top, "+this.options.colors.toolbarStart+" 0%, "+this.options.colors.toolbarEnd+" 100%"});damoUtil.setStyle(b,{filter:"progid:DXImageTransform.Microsoft.gradient( startColorstr='"+this.options.colors.toolbarStart+"', endColorstr='"+this.options.colors.toolbarEnd+"',GradientType=0 )"})};DamoEditor.prototype.damoResizeMorebtnClick=function(a){this.closePanels(this.overflowBar);if(damoUtil.getStyle(this.overflowBar,"visibility")==="hidden"){damoUtil.setStyle(this.overflowBar,{visibility:"visible"})}else{damoUtil.setStyle(this.overflowBar,{visibility:"hidden"})}};DamoEditor.prototype.damoResize=function(e){var c=damoUtil.getStyleI(this.toolbar,"width");var f=this.toolbar.getElementsByClassName("subbar");while(this.overflowBar.firstChild){var g=this.overflowBar.firstChild;var a=g.getAttribute("toolGroup");if(a){f[a].appendChild(g)}else{this.toolbar.appendChild(g)}}for(var b=0;b<f.length;b++){d(f[b],c,-20,this.overflowBar)}damoUtil.setStyle(this.morePn,{display:this.overflowBar.firstChild?"inline-block":"none"});function d(k,l,o,h){var n=0;var p=h.firstChild;var m=k.firstChild;var q=0;while(m&&m!==null){if(m.className!=="damoSelectBoxPanel"){q=damoUtil.getNodeWidth(m);n+=q}m=m.nextSibling}if(n<=l-5){return}var j=n;while(n>(l+o)){m=k.lastChild;m.setAttribute("toolGroup",k.id);if(m.className!=="damoSelectBoxPanel"){q=damoUtil.getNodeWidth(m);n-=q}h.insertBefore(m,p);p=m}j-=n;damoUtil.setStyle(h,{"min-width":j+C_PX,left:(-j)+C_PX})}};DamoEditor.prototype.damoDropEvent=function(a){setTimeout(this.undoManager.record.closure(this.undoManager),10)};DamoEditor.prototype.setEditorMode=function(){this.modeTabs=new DamoEditorMode(this)};DamoEditor.prototype.getClipboardData=function(b){var a=null;if(b.originalEvent){a=b.originalEvent}if(window.clipboardData){a=window.clipboardData}else{a=b.clipboardData}return a};DamoEditor.prototype.damoPasteEvent=function(a){var j=this.getClipboardData(a);var g=this;if(!j.types){return false}var k=new RegExp(/<(TABLE)[^>]*>/,"i");var d=j.getData("text/html");var h=j.types;if((h.contains&&h.contains("text/html"))||(h.indexOf&&h.indexOf("text/html")>-1)){if(k.test(d)){if(damoUtil.isEdge){return true}var l=document.createElement("DIV");l.innerHTML=d;var e=damoUtil.getRange();if(!e.isCollapsed){e.deleteContents()}for(var c=l.childNodes.length-1;c>-1;c--){var b=l.childNodes[c];if(b.nodeName==="META"||b.nodeName==="LINK"||b.nodeName==="STYLE"||b.nodeName==="#comment"){continue}if(b.nodeName==="TABLE"&&!damoUtil.isIE){b.border=1}e.insertNode(b)}}else{if(j.getData("text/plain")===""){a.preventDefault();return}return true;var l=document.createElement("DIV");l.innerHTML=d;var e=damoUtil.getRange();if(!e.isCollapsed){e.deleteContents()}for(var c=l.childNodes.length-1;c>-1;c--){var b=l.childNodes[c];if(b.nodeName==="META"||b.nodeName==="LINK"||b.nodeName==="STYLE"||b.nodeName==="#comment"){continue}if(b.nodeName==="P"){if(b.style.fontFamily===""){b.style.fontFamily="맑은 고딕"}}e.insertNode(b)}}a.preventDefault();return false}if((h.contains&&h.contains("Files"))||(h.indexOf&&h.indexOf("Files")>-1)){var f=j.items;if(f.length>0){for(var c=0;c<f.length;c++){if(f[c].type.indexOf("image")!==-1){this.sendFile(g,null,f[c].getAsFile())}}}a.preventDefault();return false}return true};DamoEditor.prototype.sendFile=function(c,e,b){if(b===null){return}var d=new FormData();d.append("damoImgFile",b,"damoImgFile");damoAjax({url:c.options.uploadURL,data:d,done:a});function a(f){var h=damoUtil.getRange();var g=h.startContainer;var j=h.startOffset;var k=damoUtil.createElement("IMG");k.setAttribute("src",f);h.deleteContents();h.insertNode(k);damoUtil.setSelection(damoUtil.getSelection(),h,g,j);h=null}};DamoEditor.prototype.editorBlur=function(){this.closePanels()};DamoEditor.prototype.editorFocus=function(){damoEditors.activeEditor=this};DamoEditor.prototype.saveRange=function(){this.range=damoUtil.getRange()};DamoEditor.prototype.restoreRange=function(){if(!this.range||this.range.collapse){return}var a=damoUtil.getSelection();a.removeAllRanges();a.addRange(this.range);this.focus()};DamoEditor.prototype.focus=function(){if(!this.editor.focued){this.editor.focus()}};DamoEditor.prototype.editorMousedown=function(a){if(a.target.nodeName==="IMG"){this.buttonsDisable(true,"undo,redo,copy,cut,paste,image,justifyleft,justifycenter,justifyright,justifyfull");this.activateButton(a.target)}else{this.buttonsDisable(false,"bgcolor4td");this.activateButton()}};DamoEditor.prototype.editorKeydown=function(b){if(!b.ctrlKey||b.keyCode===17){return}var a=this.shortcutList[b.keyCode];if(a){a.click(this);damoUtil.preventEvent(b)}};DamoEditor.prototype.editorKeyup=function(a){if((a.keyCode<33||a.keyCode>46)&a.keyCode!==13){return}this.activateButton()};DamoEditor.prototype.executeClick=function(c){for(var b=0;b<this.buttonList.length;b++){var a=this.buttonList[b];if(a.command===c){a.button.click(this);return}}};DamoEditor.prototype.removeElement=function(){this.activeElement.parentNode.removeChild(this.activeElement);this.activeElement=null};DamoEditor.prototype.activateButton=function(src){if(!src){src=damoUtil.getElementFromHierarchy()}if(!src){return}this.activeElement=src;this.saveRange();this.closePanels();this.buttonUnSelect();var fontSize=null,fontFamily=null,fontformat=null,textAlign=null,lineheight=null;while(src&&src!==this.editor){for(var inx in this.tagButtonList){var button=this.tagButtonList[inx];if(src.nodeName.match(eval("/"+button.tags+"/"))){damoUtil.addClass(button.button,"buttonSelect");break}else{if(fontformat===null&"H1,H2,H3,H4,H5,H6".indexOf(src.nodeName)>-1){fontformat=src.nodeName;if(textAlign===null){textAlign=src.align}if(lineheight===null){lineheight=this.getLineheight(src,"line-height")}}}}if(src.nodeType!==3){if(fontSize===null&&src.style.fontSize!==null){fontSize=this.getFontStyle(src,"font-size")}if(fontFamily===null&&src.style.fontFamily!==null){fontFamily=this.getFontStyle(src,"font-family")}if(lineheight===null&&src.style.lineHeight!==null){lineheight=this.getLineheight(src,"line-height")}if(textAlign===null&&"PDIV".indexOf(src.nodeName)>-1){textAlign=src.style.textAlign}}if(lineheight===null&&src.nodeName==="P"){lineheight=this.getLineheight(src,"line-height")}src=src.parentNode}this.selectedExtendButton(damoSelectBoxFontsize,fontSize?fontSize:this.getFontStyle(src,"font-size"));this.selectedExtendButton(damoSelectBoxFontname,fontFamily?fontFamily:this.getFontStyle(src,"font-family"));this.selectedExtendButton(damoSelectBoxFontformat,fontformat);this.selectedAlignButton(textAlign)};DamoEditor.prototype.getFontStyle=function(c,b){var a=null;a=damoUtil.getStyle(c,b).replace('"',"");if(a.indexOf(C_PX)>-1){a=Math.ceil(parseInt(a)*3/4)+"pt"}else{if(a.indexOf("em")>-1){a=Math.ceil(parseInt(a)*12)+"pt"}}return a};DamoEditor.prototype.getLineheight=function(e,c){var b=damoUtil.getStyle(e,c);if(!b){return null}var a=parseFloat(b);if(!a){return"120%"}if(b.indexOf(C_PX)>-1){var d=damoUtil.getStyle(e,"font-size");b=(Math.round(a/parseFloat(d)*10)*10)+"%"}else{b=a}return b};DamoEditor.prototype.selectedExtendButton=function(a,c){for(var b in this.extendButton){if(this.extendButton[b] instanceof a){this.extendButton[b].setTitle(c)}}};DamoEditor.prototype.selectedAlignButton=function(b){if(!this.toggleBtns){return}if(b==="justify"){b="full"}var a=this.toggleBtns.a;for(var c in a){if(a[c].command.indexOf(b)>0){damoUtil.addClass(a[c].button,"buttonSelect")}else{damoUtil.removeClass(a[c].button,"buttonSelect")}}};DamoEditor.prototype.closePanels=function(a){var c=document.getElementsByClassName("damoSelectBoxPanel");for(var b=0;b<c.length;b++){c[b].style.display="none"}if(a!==this.overflowBar){damoUtil.setStyle(this.overflowBar,{visibility:"hidden"})}};DamoEditor.prototype.buttonUnSelect=function(){for(var a in this.tagButtonList){damoUtil.removeClass(this.tagButtonList[a].button,"buttonSelect")}};DamoEditor.prototype.getLength=function(){var a=damoUtil.getStyle(this.editor,"display");if(a!=="none"){if(this.editor.innerText===""&&this.editor.innerHTML.length<12){return 0}return this.editor.innerHTML.length}else{return this.modeTabs.editorETC.innerText.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"").length}};DamoEditor.prototype.saveContents=function(){var b=damoUtil.getStyle(this.editor,"display");var a;if(b==="none"){a=this.modeTabs.editorETC.innerText;this.editor.innerHTML=a}else{a=this.editor.innerHTML}if(this.options.xss.used){damoUtil.protectFromXSS(this.editor,this.options.xss)}this.contentEditor.value=damoUtil.removeLayoutCSS(this.editor.innerHTML)};DamoEditor.prototype.clearDocument=function(){this.editor.innerHTML="<p>"+damoUtil.getBlankChar()+"</p>";var a=damoUtil.getStyle(this.editor,"background-image");damoUtil.setStyle(this.editor,{"background-color":"transparent","background-image":"none"});if(a!=="none"){damoUtil.setStyle(this.editor,{"background-attachment":"","background-repeat":"","background-position":""})}};DamoEditor.prototype.buttonsDisable=function(f,e){var d=this.buttonList;if(f){for(var c in d){var b=d[c];this.buttonDisable(b,!(e&&e.indexOf(b.command)>-1))}}else{for(var c in d){var b=d[c];this.buttonDisable(b,e&&e.indexOf(b.command)>-1)}}this.undoManager.changed(this.undoManager)};DamoEditor.prototype.buttonDisable=function(a,b){if(b){a.button.setAttribute("disabled",b);damoUtil.addClass(a.button,"buttonDisable")}else{a.button.removeAttribute("disabled");damoUtil.removeClass(a.button,"buttonDisable")}};DamoEditor.prototype.undoRecord=function(){this.undoManager.record()};DamoEditor.prototype.setHtmlContent=function(a){if(a.trim()===""){a="<p>"+damoUtil.getBlankChar()+"</p>"}this.editor.innerHTML=a;this.setEditorProperty(this.editor);if(this.options.xss.used){damoUtil.protectFromXSS(this.editor,this.options.xss)}};DamoEditor.prototype.setEditorProperty=function(b){var c=b.querySelector("#damoEditorBack");if(!c){damoUtil.setStyle(b,{"background-color":"transparent","background-image":"none"});return}var d=null;while(d=c.firstChild){b.appendChild(d)}damoUtil.setStyle(b,{"background-color":damoUtil.getStyleA(c,"background-color")});var a=damoUtil.getStyle(c,"background-image");if(a!=="none"){damoUtil.setStyle(b,{"background-image":a,"background-attachment":damoUtil.getStyle(c,"background-attachment"),"background-repeat":damoUtil.getStyle(c,"background-repeat"),"background-position":damoUtil.getStyle(c,"background-position-x")+" "+damoUtil.getStyle(c,"background-position-y")})}b.removeChild(c)};DamoEditor.prototype.getEditorContent=function(b){var c=damoUtil.getStyleA(b,"background-color");var a=damoUtil.getStyle(b,"background-image");if(c==="transparent"&&a==="none"){return b.innerHTML}var d="<div id='damoEditorBack' style='width:100%;";if(c!=="transparent"){d+="background-color:"+c+";"}if(a!=="none"){d+="background-image:"+a+"; background-attachment:"+damoUtil.getStyle(b,"background-attachment")+";background-repeat:"+damoUtil.getStyle(b,"background-repeat")+";background-position:"+damoUtil.getStyle(b,"background-position-x")+" "+damoUtil.getStyle(b,"background-position-y")}return d+"'>"+b.innerHTML+"</div>"};function DamoEditorMode(f){this.parent=f;this.editor=f.editor;this.editorETC=damoUtil.createElement("textarea",f.damoEditor,"editor");var e=parseInt(damoUtil.getStyle(this.editor,"height"));damoUtil.setStyle(this.editorETC,{display:"none",height:e+parseInt(damoUtil.getStyle(this.editor,"padding-top"))*2+C_PX,width:"100%",padding:"0px"});this.preview=damoUtil.createElement("div",f.damoEditor,"editor");damoUtil.setStyle(this.preview,{display:"none",height:e+C_PX});var a=damoUtil.createElement("div",f.damoEditor,"damoEditorBottom");this.editorView={design:this.editor,html:this.editorETC,text:this.editorETC,preview:this.preview};var d=["design","html","text","preview"];for(var b=0;b<d.length;b++){var c=damoUtil.createElement("div",a,"damoEditorBottomTab");c.innerText=this.parent.DamoMessage.editorMode[d[b]];c.id=d[b];damoUtil.addEvent(c,"click",this.damoEditorBottomTabChange.closure(this,c));if(b===0){this.damoEditorBottomTabChange(c)}if(f.options.colors){damoUtil.setStyle(c,{background:f.options.colors.bottom})}}if(f.options.colors){damoUtil.setStyle(a,{background:f.options.colors.bottom,"border-top-color":f.options.colors.bottomTop})}return this}DamoEditorMode.prototype.damoEditorBottomTabChange=function(d){if(this.activetab===d){return}if(d.id==="text"){if(!confirm(this.parent.DamoMessage.editorMode.msg.textMode)){return}}if(this.activetab){damoUtil.removeClass(this.activetab,"damoEditorBottomTabActive")}damoUtil.addClass(d,"damoEditorBottomTabActive");if(!this.activetab){this.activetab=d;return}this.damoEditorBottomTabDisplay(this.editorView[this.activetab.id],this.editorView[d.id]);if(this.activetab.id==="preview"){this.activetab=this.activetab4preview}this.parent.buttonsDisable(d.id!=="design");if(this.activetab===d){return}if(d.id==="design"){var c="";if(this.activetab.id==="html"){c=this.editorETC.value}else{c=this.HTML2Text(this.editorETC.value)}this.parent.setHtmlContent(c);var a=document.getElementsByClassName("damoLayoutInput");for(var b=0;b<a.length;b++){damoUtil.addClass(a[b],"damoLayoutDot")}this.editorETC.value="";this.preview.innerHTML=""}else{if(d.id==="preview"){if(this.activetab.id==="design"){this.preview.innerHTML=damoUtil.removeLayoutCSS(this.parent.getEditorContent(this.editor))}else{if(this.activetab.id==="html"){this.preview.innerHTML=this.editorETC.value}else{this.preview.innerHTML=this.Text2HTML(this.editorETC.value)}}this.activetab4preview=this.activetab}else{if(d.id==="html"){if(this.activetab.id==="design"){this.editorETC.value=damoUtil.removeLayoutCSS(this.parent.getEditorContent(this.editor))}else{this.editorETC.value=this.Text2HTML(this.editorETC.value)}}else{if(this.activetab.id==="design"){this.editorETC.value=this.HTML2Text(this.parent.getEditorContent(this.editor))}else{this.editorETC.value=this.HTML2Text(this.editorETC.value)}}}}this.activetab=d};DamoEditorMode.prototype.damoEditorBottomTabDisplay=function(a,b){if(a){damoUtil.setStyle(a,{display:"none"})}damoUtil.setStyle(b,{display:""});b.focus()};DamoEditorMode.prototype.Text2HTML=function(f){var e="";var a=f.split("\n");var c="<BR>";if(damoUtil.isIE){c="&nbsp;"}for(var b=0;b<a.length;b++){var d=a[b].replace(/[\r|\n]/g,"");if(d===null||d===""){d=c}e=e+"<p>"+d+"</p>\n"}return e};DamoEditorMode.prototype.HTML2Text=function(a){a=a.replace(/[\r|\n|\t|\v|\f]/g,"");a=a.replace(/<p><br><\/p>|<P>&nbsp;<\/P>/gi,"\n");a=a.replace(/<br(\s)*\/?>|<br(\s[^\/]*)?>|<\/p(\s[^\/]*)?>/gi,"\n");a=a.replace(/<\/li(\s[^\/]*)?>|<\/tr(\s[^\/]*)?>/gi,"\n");a=this.strip_tags(a,false);a=a.replace(/[\n]*$/g,"");a=a.replace(new RegExp("damoLayoutDot","g"),"");return a};DamoEditorMode.prototype.strip_tags=function(a,c){c=(((c||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var b=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;var d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(d,"").replace(b,function(f,e){return c.indexOf("<"+e.toLowerCase()+">")>-1?f:""})};function DamoButton(e,d,c){this.command=d.command;this.tags=d.tags;this.editor=e;var f=damoUtil.createElement("button",e.toolbar,"damoButton");f.setAttribute("type","button");if(c){damoUtil.addClass(f,"groupButton")}damoUtil.setStyle(f,{backgroundPosition:(d.icon*-editorConfig.iconsize)+"px 0px"});f.title=d.title;if(d.dialogHandler){var b=new d.dialogHandler().init(e);damoUtil.addEvent(f,"click",b.open.closure(b),true)}else{if(d.clickClass){var a=new d.clickClass();a=a.init(e,d,this);damoUtil.addEvent(f,"click",a.buttonClick.closure(a,this),true)}else{if(d.clickEvent){damoUtil.addEvent(f,"click",d.clickEvent.closureListener(this),true)}else{if(d.command!=="undo"&&d.command!=="redo"){damoUtil.addEvent(f,"click",this.buttonClick.closure(this),true)}}}}damoUtil.addEvent(f,"mousedown",e.restoreRange.closure(e),false);this.button=f;return this}DamoButton.prototype.buttonClick=function(){if(this.command==="insertHorizontalRule"){var c=damoUtil.getRange();var b=c.startContainer;var f=c.startOffset;var d=document.createElement("HR");d.style.height="1px";c.deleteContents();c.insertNode(d);this.editor.focus();damoUtil.setSelection(damoUtil.getSelection(),c,b,f)}else{if(!rangeUtil.execCommand(this.command,null,damoTableEditor.selectList)){return}}this.editor.undoRecord();var e=damoUtil.getElementFromSibling(damoUtil.getRange());if(!e){return}while(e.firstChild){e=e.firstChild}this.editor.activateButton(e)};DamoButton.prototype.buttonsDisable=function(){damoUtil.toggleClass(this.button,"buttonDisable")};function damoNewClick(){if(!confirm(this.editor.DamoMessage.msg.clear)){return false}this.editor.clearDocument();this.editor.undoManager.clearUndo(this.editor.editor.innerHTML);return true}function damoGetContent(a){return"<!DOCTYPE html>\n<html>\n<head>\n<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />\n<title>damoWebEditor</title></head>\n<body>\n"+a+"</body>\n<html>"}function damoSaveClick(){var c="damoWebEditor.html";var f="data:text/plain;charset=utf-8,";var e=this.editor.getEditorContent(this.editor.editor);damoUtil.removeLayoutCSS(e);if(damoUtil.detectIE()){var d=new Blob([damoGetContent(e)]);window.navigator.msSaveBlob(d,c)}else{var b=document.createElement("a");document.body.appendChild(b);b.href=f+damoGetContent(e);b.download=c;b.click();document.body.removeChild(b)}}function damoPrintClick(){var a=damoUtil.getStyleI(this.editor.editor,"width");if(a<700){a=700}var b=window.open("","","width="+a+",height=500, scrollbars=yes");b.document.write(damoGetContent(this.editor.getEditorContent(this.editor.editor)));b.document.close();b.focus();b.print()}function damoPasteClick(a){if(!this.editor.getClipboardData(a)){alert(this.editor.DamoMessage.msg.pasteWarning);return}this.editor.focus();document.execCommand("paste",false,null);this.editor.undoRecord();var b=damoUtil.getElementFromHierarchy();while(b.firstChild){b=b.firstChild}this.editor.activateButton(b)}function damoIndentClick(){damoIndentOutdent(20,this.editor)}function damoOutdentClick(){damoIndentOutdent(-20,this.editor)}function damoIndentOutdent(f,d){d.focus();if(damoTableEditor.selectList.length>0){var e=damoUtil.getSelection();var a=damoUtil.getRangeCreate();for(var b=0;b<damoTableEditor.selectList.length;b++){c(damoTableEditor.selectList[b])}e.removeAllRanges()}else{var a=damoUtil.getRange();if(a){c(a.startContainer)}}d.undoRecord();function c(h){var g=rangeUtil.findTags(h,"^P|OL|UL");if(!g||g.length===0){return}for(var j=0;j<g.length;j++){var k=g[j];var l=damoUtil.getStyle(k,"padding-left");if(!l){l=0}else{l=parseInt(l)+f}if(l<0){l=0}damoUtil.setStyle(k,{"padding-left":l+C_PX})}}}function damoToggleButtonEvent(){}damoToggleButtonEvent.prototype.init=function(b,a,c){c.toggleGroup=a.group;if(a.group){if(!b.toggleBtns){b.toggleBtns={}}if(!b.toggleBtns[a.group]){b.toggleBtns[a.group]={}}b.toggleBtns[a.group][a.command]=c}return this};damoToggleButtonEvent.prototype.buttonsDisable=function(){damoUtil.toggleClass(this.button,"buttonDisable")};damoToggleButtonEvent.prototype.activateButton=function(a,d,b){for(var c in d){damoUtil.removeClass(d[c].button,"buttonSelect")}damoUtil.addClass(a,"buttonSelect")};damoToggleButtonEvent.prototype.multiBlockExec=function(c){var d=damoUtil.getSelection();var a=damoUtil.getRangeCreate();for(var b=0;b<damoTableEditor.selectList.length;b++){damoUtil.setSelection2(d,a,damoTableEditor.selectList[b].firstChild);this.execCommand(c,damoTableEditor.selectList[b])}d.removeAllRanges()};function damoAlignButtonEvent(){this.buttonClick=function(a){if(damoTableEditor.selectList.length>0){this.multiBlockExec(a)}else{this.execCommand(a)}a.editor.undoRecord();this.activateButton(a.button,a.editor.toggleBtns[a.toggleGroup],"buttonSelect");a.editor.focus()},this.execCommand=function(c){document.execCommand(c.command,false,null);var d=rangeUtil.findElementByTag("^P$|DIV");if(d){var b=c.command.replace("justify","");if(b==="full"){b="justify"}damoUtil.setStyle(d,{"text-align":b})}}}damoAlignButtonEvent.prototype=new damoToggleButtonEvent();function damoOrderButtonEvent(){this.buttonClick=function(b){b.editor.focus();if(damoTableEditor.selectList.length>0){this.multiBlockExec(b)}else{var a=damoUtil.getRange();this.execCommand(b,a.startContainer)}b.editor.undoRecord();this.activateButton(b.button,b.editor.toggleBtns[b.toggleGroup],"buttonSelect")},this.execCommand=function(a,b){document.execCommand(a.command,false,"");var b=rangeUtil.findTag(b,"OL|UL");if(b){if(a.command==="insertorderedlist"){damoUtil.setStyle(b,{"list-style-type":"decimal"})}else{damoUtil.setStyle(b,{"list-style-type":"disc"})}damoUtil.setStyle(b,{overflow:"visible"})}}}damoOrderButtonEvent.prototype=new damoToggleButtonEvent();function DamoSelectBox(){this.button=null;this.panelwidth=150;this.width="100px";this.selectedValue=null;this.isMenu=true}DamoSelectBox.prototype.initialize=function(b,a){this.command=a.command;this.editor=b;if(b.toolbar){this.button=damoUtil.createElement("div",b.toolbar,"damoSelectBox","click",this.damoSelectBoxClick.closure(this),true)}else{this.button=damoUtil.createElement("div",b,"damoSelectBox","click",this.damoSelectBoxClick.closure(this),true)}damoUtil.setStyle(this.button,{width:this.width,"background-color":"#FFFFFF"});this.button.selecttitle=damoUtil.createElement("div",this.button,"selecttitle");this.button.selecttitle.innerHTML=a.title;damoUtil.setStyle(this.button.selecttitle,{width:(parseInt(this.width)-editorConfig.iconsize+4)+C_PX});var c=damoUtil.createElement("div",this.button,"dropbutton");damoUtil.setStyle(c,{backgroundPosition:"-3px 0px",border:"0px"});if(a.command){b.extendButton.push(this)}};DamoSelectBox.prototype.damoSelectBoxClick=function(){if(damoUtil.hasClass(this.button,"buttonDisable")){this.hide();return}if(!this.panel){this.setPanel()}if(this.panel.style.display==="none"){this.show()}else{this.hide();this.editor.focus()}};DamoSelectBox.prototype.show4timer=function(){this.panel.style.display="block";this.calcPanelPosition(this.panel);this.showPanel()};DamoSelectBox.prototype.show=function(){if(this.editor.closePanels){if(damoUtil.detectIE()){this.editor.editor.blur();this.editor.closePanels(this.button.parentNode);setTimeout(this.show4timer.closure(this),50)}else{this.editor.closePanels(this.button.parentNode);this.show4timer()}}else{this.closePanels();this.show4timer()}};DamoSelectBox.prototype.closePanels=function(){var b=document.getElementsByClassName("damoSelectBoxPanel");for(var a=0;a<b.length;a++){b[a].style.display="none"}};DamoSelectBox.prototype.addPanel=function(){var a=(this.isMenu)?this.editor.toolbar:this.button.parentNode.parentNode;panel=damoUtil.createElement("div",a,"damoSelectBoxPanel");panel.style.display="none";this.calcPanelPosition(panel);return panel};DamoSelectBox.prototype.calcPanelPosition=function(b){var c=this.button;var d;if(this.isMenu){if(this.button.parentNode===this.editor.overflowBar){c.parentNode.appendChild(b)}else{this.editor.toolbar.appendChild(b)}var d=damoUtil.getElementPosition(c);var a=damoUtil.getStyleI(this.editor.toolbar,"width");if(d.left+this.panelwidth>a){d.left=a-this.panelwidth-20}}else{var d=damoUtil.getElementPosition(c)}damoUtil.setStyle(b,{left:d.left+C_PX,top:(d.top+c.offsetHeight)+C_PX,width:this.panelwidth+C_PX})};DamoSelectBox.prototype.showPanel=function(){};DamoSelectBox.prototype.setPanel=function(){this.panel=this.addPanel();for(var a in this.items){this.addItem(a,this.items[a])}if(this.showEvent){this.showEvent()}};DamoSelectBox.prototype.hide=function(){if(this.panel){this.panel.style.display="none"}};DamoSelectBox.prototype.addItem=function(a,c){var b=damoUtil.createElement("div",this.panel,"damoSelectBoxItem","click",this.damoSelectBoxItemClick.closure(this,a),false);this.setItem(b,c,a)};DamoSelectBox.prototype.damoSelectBoxItemClick=function(a){this.hide();this.selectedItemEvent(a);this.editor.oldsrc=null;if(this.isMenu){this.editor.undoRecord()}};DamoSelectBox.prototype.setTitle=function(a){this.button.selecttitle.innerText=a};DamoSelectBox.prototype.buttonsDisable=function(){damoUtil.toggleClass(this.button,"buttonDisable")};DamoSelectBox.prototype.execCommand=function(b,e,f){var a=b.collapsed;var d=rangeUtil.getSpanList(b);for(var c=0;c<d.length;c++){d[c].style[e]=f;if(d.length===1&&d[c].innerHTML===""){d[c].innerText=unescape("%uFEFF")}}if(a&&d.length===1){damoUtil.setSelection(damoUtil.getSelection(),b,d[0],1)}};DamoSelectBox.prototype.setStyle=function(c,e){var a=damoUtil.getRange();if((!a||a.collapsed)&&damoTableEditor.selectList.length>0){var d=damoUtil.getSelection();a=damoUtil.getRangeCreate();for(var b=0;b<damoTableEditor.selectList.length;b++){damoUtil.setSelection2(d,a,damoTableEditor.selectList[b]);this.execCommand(a,c,e)}a.collapse(false);d.removeAllRanges()}else{this.execCommand(a,c,e)}};function damoSelectBoxFontname(){var a=["돋움","돋움체","굴림","굴림체","바탕","바탕체","궁서","Arial","Courier New","Times New Roman","Verdana"];this.width="61px";this.panelwidth=158;this.init=function(c,b){this.items=c.options.fonts||a;this.initialize(c,b);return this};this.setItem=function(b,c){b.innerHTML="<font face='"+c+"'>"+c+"</font>"};this.selectedItemEvent=function(c){var b=this.items[c];this.setTitle(b);this.setStyle("fontFamily",b)}}damoSelectBoxFontname.prototype=new DamoSelectBox();function damoSelectBoxFontsize(){this.items=["9pt","10pt","12pt","14pt","16pt","20pt","24pt","30pt","36pt"];this.width="36px";this.panelwidth=158;this.init=function(b,a){this.initialize(b,a);return this};this.setItem=function(a,b){a.innerHTML="<font style='font-size:"+b+"'>"+b+"</font>"};this.selectedItemEvent=function(a){var b=this.items[a];this.setTitle(b);this.setStyle("fontSize",b)};this.setTitle=function(a){this.button.selecttitle.innerText=a.replace("pt","")}}damoSelectBoxFontsize.prototype=new DamoSelectBox();function damoSelectBoxFontformat(){this.items={H1:"Heading 1",H2:"Heading 2",H3:"Heading 3",H4:"Heading 4",H5:"Heading 5",H6:"Heading 6"};this.width="94px";this.panelwidth=200;this.init=function(b,a){this.initialize(b,a);return this};this.setItem=function(b,c,a){b.innerHTML="<"+a+">"+c+"</"+a+">"};this.selectedItemEvent=function(a){rangeUtil.execCommand(this.command,"<"+a+">",damoTableEditor.selectList);this.button.selecttitle.innerText=this.items[a];this.editor.activateButton()},this.setTitle=function(a){if(this.items[a]){this.button.selecttitle.innerText=this.items[a]}else{this.button.selecttitle.innerText=editorConfig.buttons.fontformat.title}}}damoSelectBoxFontformat.prototype=new DamoSelectBox();function damoSelectButton(){this.initialize=function(c,b,a){this.command=b.command;this.editor=c;if(c.toolbar){this.button=damoUtil.createElement("div",c.toolbar,"damoSelectButton")}else{this.button=damoUtil.createElement("div",c,"damoSelectButton")}damoUtil.setStyle(this.button,{border:"1px solid #fbfcfd"});this.button.selecttitle=damoUtil.createElement("div",this.button,"damoButton","click",this.damoSelectButtonClick.closure(this),true);this.button.selecttitle.title=b.title;damoUtil.setStyle(this.button.selecttitle,{backgroundPosition:(b.icon*-editorConfig.iconsize)+"px 0px"});if(a){this.button.selecttitlecolor=damoUtil.createElement("div",this.button.selecttitle,"buttonColor")}var d=damoUtil.createElement("div",this.button,"dropbutton","click",this.damoSelectBoxClick.closure(this),true);damoUtil.setStyle(d,{backgroundPosition:"-8px 0px",width:"10px"});if(b.command){c.extendButton.push(this)}};this.changeToGroup=function(){damoUtil.addClass(this.button,"damoSelectBoxGroup")};this.damoSelectButtonClick=function(){if(this.button.disabled){return}this.selectedItemEvent(this.selectedValue);this.editor.undoRecord();this.editor.closePanels()};this.addItem=function(a,c){var b=damoUtil.createElement("div",this.panel,"damoSelectButtonItem","click",this.damoSelectBoxItemClick.closure(this,a),false);this.setItem(b,c,a)}}damoSelectButton.prototype=new DamoSelectBox();function damoSelectButtonLineheight(){this.items={1:"100%",2:"120%",3:"140%",4:"160%",5:"180%",6:"200%",7:"300%"};this.panelwidth=60;this.init=function(b,a){this.initialize(b,a);return this};this.setItem=function(b,c,a){b.innerHTML=c;damoUtil.removeClass(b,"damoSelectButtonItem");damoUtil.addClass(b,"damoSelectBoxLineheightItem")};this.selectedItemEvent=function(c){var e=this.items[c];if(damoTableEditor.selectList.length>0){var d=damoUtil.getSelection();var a=damoUtil.getRangeCreate();for(var b=0;b<damoTableEditor.selectList.length;b++){damoUtil.setSelection2(d,a,damoTableEditor.selectList[b]);this.execCommand(a,e)}d.removeAllRanges()}else{this.execCommand(damoUtil.getRange(),e)}},this.execCommand=function(a,c){var d=rangeUtil.getAllTagList(a,/^P$|^H([0-9])|OL|UL/);for(var b=0;b<d.length;b++){damoUtil.setStyle(d[b],{"line-height":c})}};this.damoSelectButtonClick=function(){this.damoSelectBoxClick()}}damoSelectButtonLineheight.prototype=new damoSelectButton();function damoSelectBoxColor(){this.items=["#ff0000","#ff5e00","#ffbb00","#ffe400","#abf200","#1fda11","#00d8ff","#0055ff","#0900ff","#6600ff","#ff00dd","#ff007f","#000000","#ffffff","#ffd8d8","#fae0d4","#faecc5","#faf4c0","#e4f7ba","#cefbc9","#d4f4fa","#d9e5ff","#dad9ff","#e8d9ff","#ffd9fa","#ffd9ec","#f6f6f6","#eaeaea","#f15f5f","#f29661","#f2cb61","#e5d85c","#bce55c","#86e57f","#5cd1e5","#6699ff","#6b66ff","#a366ff","#f261df","#f261aa","#a6a6a6","#8c8c8c","#670000","#662500","#664b00","#665c00","#476600","#22741c","#005766","#002266","#030066","#290066","#660058","#660033","#464646","#212121","#000000"];this.panelwidth=180;this.selectedValue="#000000";this.init=function(b,a){this.initialize(b,a,true);return this};this.showEvent=function(){this.moreBtn=damoUtil.createElement("button",this.panel);this.moreBtn.setAttribute("type","button");this.moreBtn.innerHTML=this.editor.DamoMessage.colorPicker.more;damoUtil.addEvent(this.moreBtn,"click",this.moreColor.closureListener(this));damoUtil.addClass(this.moreBtn,"cp-button");damoUtil.setStyle(this.panel,{overflow:"hidden"});damoUtil.addClass(this.panel,"damoSelectBoxPanelColor")};this.moreColor=function(){var a=damoUtil.createElement("div",this.panel,"cp cp-small");a.id="colorPicker";var c=damoUtil.createElement("div",this.panel,"colorStatus");this.selectedhex=damoUtil.createElement("div",c,"selectedhex");this.selectedcolor=damoUtil.createElement("div",c,"selectedcolor");var b=damoUtil.createElement("button",c);b.setAttribute("type","button");b.innerHTML=this.moreBtn.innerHTML;damoUtil.addEvent(this.moreBtn,"click",this.moreColor.closureListener(this));damoUtil.addClass(this.moreBtn,"cp-button");damoUtil.setStyle(this.panel,{overflow:"hidden"});damoUtil.addClass(this.panel,"damoSelectBoxPanelColor")};this.moreColor=function(){var a=damoUtil.createElement("div",this.panel,"cp cp-small");a.id="colorPicker";var c=damoUtil.createElement("div",this.panel,"colorStatus");this.selectedhex=damoUtil.createElement("div",c,"selectedhex");this.selectedcolor=damoUtil.createElement("div",c,"selectedcolor");var b=damoUtil.createElement("button",c);b.setAttribute("type","button");b.innerHTML=this.editor.DamoMessage.colorPicker.ok;damoUtil.addEvent(b,"click",this.okClick.closureListener(this));damoUtil.addClass(b,"cp-button");a=ColorPicker(a,this.colorPickerChange.closureListener(this));a.setHex("#f4329c");this.moreBtn.disabled="false"};this.colorPickerChange=function(a){this.selectedhex.innerHTML=a;this.selectedcolor.style.backgroundColor=a};this.okClick=function(a){this.damoSelectBoxItemClick(this.selectedhex.innerHTML)};this.setItem=function(a,b){damoUtil.setStyle(a,{width:"8px",height:"8px","background-color":b,border:"1px solid "+b})};this.selectedItemEvent=function(d){if(d.charAt(0)!=="#"){d=this.items[d]}var b={};b[this.command.replace("fore","")]=d;this.editor.focus();var a=damoUtil.getRange();if((!a||a.collapsed)&&damoTableEditor.selectList.length>0){var e=damoUtil.getSelection();a=damoUtil.getRangeCreate();for(var c=0;c<damoTableEditor.selectList.length;c++){damoUtil.setSelection2(e,a,damoTableEditor.selectList[c]);this.execCommand(a,b)}a.collapse(false);e.removeAllRanges()}else{if(a&&!a.collapsed){this.execCommand(a,b)}}this.selectedValue=d;if(this.button.selecttitlecolor){damoUtil.setStyle(this.button.selecttitlecolor,{"background-color":d})}};this.execCommand=function(b,a){var d=rangeUtil.getSpanList(b);for(var c=0;c<d.length;c++){damoUtil.setStyle(d[c],a)}}}damoSelectBoxColor.prototype=new damoSelectButton();function damoSelectBoxColor4td(){this.selectedItemEvent=function(b){if(b.charAt(0)!=="#"){b=this.items[b]}for(var a=0;a<damoTableEditor.selectList.length;a++){damoUtil.setStyle(damoTableEditor.selectList[a],{"background-color":b})}this.selectedValue=b;damoUtil.setStyle(this.button.selecttitlecolor,{"background-color":b})}}damoSelectBoxColor4td.prototype=new damoSelectBoxColor();function damoSelectBoxAlign(){this.items={0:"left",1:"center",2:"right",3:"justify"};var a=[],b=0;this.panelwidth=30;this.init=function(d,c){this.initialize(d,c);this.setPanel();return this};this.setItem=function(d,e,c){btn=new DamoButton(this.editor,editorConfig.buttons[e],false);d.appendChild(btn.button);a[c]=btn;damoUtil.removeClass(d,"damoSelectButtonItem")};this.selectedItemEvent=function(c){b=parseInt(c);var d=damoUtil.getStyle(a[b].button,"background-position-x");damoUtil.setStyle(this.button.selecttitle,{backgroundPosition:d+" 0px"})},this.damoSelectButtonClick=function(){a[b].button.click()}}damoSelectBoxAlign.prototype=new damoSelectButton();function damoButtonExt(){this.init=function(b,a,c){this.editor=b;this.button=c;return this};this.buttonClick=function(a){this.editor.focus();if(damoUtil.hasClass(this.button.button,"buttonDisable")){this.hide();return}if(!this.panel){this.setPanel()}if(this.panel.style.display==="none"){this.show()}else{this.hide()}}}damoButtonExt.prototype.show=function(){this.editor.closePanels(this.button.button.parentNode);this.panel.style.display="block";this.calcPanelPosition(this.panel);this.showPanel()};damoButtonExt.prototype.hide=function(){this.panel.style.display="none"};damoButtonExt.prototype.addPanel=function(){panel=damoUtil.createElement("div",this.editor.toolbar,"damoSelectBoxPanel");panel.style.display="none";this.calcPanelPosition(panel);return panel};damoButtonExt.prototype.calcPanelPosition=function(b){var c=this.button.button;c.parentNode.appendChild(b);var d=damoUtil.getElementPosition(c);var a=damoUtil.getStyleI(this.editor.toolbar,"width");if(d.left+this.panelwidth>a){d.left=(d.left-this.panelwidth)}damoUtil.setStyle(b,{left:d.left+C_PX,top:(d.top+c.offsetHeight)+C_PX,width:this.panelwidth+C_PX})};function damoButtonTable(){this.panelwidth=170;this.showPanel=function(){this.selectArea(null,0,0)};this.setPanel=function(){this.panel=this.addPanel();damoUtil.addClass(this.panel,"damoSelectBoxPanelTable");this.table=damoUtil.createElement("table",this.panel,"tablePicker");damoUtil.addEvent(this.table,"mouseleave",this.mouseleave.closureListener(this));var d=damoUtil.createElement("tr",this.table);this.tablePickerDsp=damoUtil.createElement("td",d,"tablePickerDsp");this.tablePickerDsp.innerHTML="&nbsp;";this.tablePickerDsp.colSpan=10;for(var c=0;c<10;c++){var d=damoUtil.createElement("tr",this.table);for(var a=0;a<10;a++){var e=damoUtil.createElement("td",d,"tablePickerCell");damoUtil.addEvent(e,"mousedown",this.mousedown.closureListener(this));damoUtil.addEvent(e,"mousemove",this.mousemove.closureListener(this))}}var b=damoUtil.createElement("button",this.panel);b.setAttribute("type","button");b.innerHTML=this.editor.DamoMessage.table.title;damoUtil.addEvent(b,"click",this.makeTableBtnClick.closureListener(this))};this.makeTableBtnClick=function(){var a=new DamoDialogTable().init(this.editor);a.open()};this.mouseleave=function(a){this.selectArea(null,0,0)};this.mousedown=function(f){var h=f.target;var g=h.parentNode.rowIndex;var c=h.cellIndex+1;var h=rangeUtil.findTag(damoUtil.getRange().startContainer,"TD");var e={width:b+C_PX,border:"0px","border-collapse":"collapse","border-spacing":"0px"};var b=0;if(h){b=parseInt(damoUtil.getStyle(h,"width"))-10}else{b=parseInt(damoUtil.getStyle(this.editor.editor,"width"))-30}var a={width:Math.round(b/c)+C_PX,border:"1px solid","word-break":"break-all"};var d=damoMakeTable(damoUtil.getRange(),c,g,e,a);this.editor.closePanels();this.editor.undoRecord(d)};this.mousemove=function(b){var d=b.target;var c=d.parentNode.rowIndex;var a=d.cellIndex;this.selectArea(d,a,c)};this.selectArea=function(f,a,e){this.tablePickerDsp.innerHTML=(a+1)+" * "+e;for(var c=1;c<=10;c++){var d=this.table.rows[c];for(var b=0;b<10;b++){if(c<=e&b<=a){d.cells[b].style.backgroundColor="#85D3F1"}else{d.cells[b].style.backgroundColor="white"}}}}}damoButtonTable.prototype=new damoButtonExt();var damoActiveDialog=null;function DamoDialog(){this.st=null;this.initialize=function(a){this.editor=a};this.headMousedown=function(a){this.st={x:a.pageX,y:a.pageY};damoActiveDialog=this};this.headMouseup=function(){if(damoActiveDialog){damoActiveDialog.st=null}};this.headMousemove=function(b){if(!damoActiveDialog||!damoActiveDialog.st){return}var a=b.pageX-damoActiveDialog.st.x;var c=b.pageY-damoActiveDialog.st.y;damoActiveDialog.dialog.style.left=(parseInt(damoActiveDialog.dialog.style.left)+a)+C_PX;damoActiveDialog.dialog.style.top=(parseInt(damoActiveDialog.dialog.style.top)+c)+C_PX;damoActiveDialog.st={x:b.pageX,y:b.pageY}}}DamoDialog.prototype.show=function(f){this.saveRange();this.editor.editor.blur();this.damoDialog=damoUtil.createElement("div",document.body,"damoDialog");this.dialog=damoUtil.createElement("div",this.damoDialog,"dialog");this.head=damoUtil.createElement("div",this.dialog,"head","mousedown",this.headMousedown.closure(this));this.head.innerText=this.title;this.dialogBody=damoUtil.createElement("div",this.dialog,"dialogBody");var a=damoUtil.createElement("a",this.dialog,"closebtn","mousedown",this.close.closure(this));a.innerText=" ";var g=damoUtil.getElementPosition2(this.editor.editor);var b=(g.left-(document.documentElement.scrollLeft||document.body.scrollLeft))+(damoUtil.getStyleI(this.editor.editor,"width")-parseInt(this.width))/2;if(b<0){e=10}var e=g.top-(document.documentElement.scrollTop||document.body.scrollTop);var d=damoUtil.getStyleI(this.editor.editor,"height");var c=parseInt(this.height);if(d<c){e-=(c-d)/2}if(e<0){e=50}damoUtil.setStyle(this.dialog,{width:this.width,top:e+C_PX,left:b+C_PX});damoUtil.addEvent(window,"mouseup",this.headMouseup);damoUtil.addEvent(window,"mousemove",this.headMousemove);this.dialogBody.innerHTML=f;damoUtil.addEventByClass("damoSubmitBtn","click",this.sumit.closure(this));damoUtil.addEventByClass("damoCancelBtn","click",this.close.closure(this));if(this.editor.options.colors){damoUtil.setStyle(this.dialog,{"border-color":this.editor.options.colors.editorBorder});damoUtil.setStyle(this.dialog,{background:this.editor.options.colors.toolbarStart})}};DamoDialog.prototype.close=function(){this.damoDialog.parentNode.removeChild(this.damoDialog);this.editor.editor.focus();if(this.selection){this.selection.addRange(this.linkRange)}this.linkRange=this.selection=null};DamoDialog.prototype.sumit=function(){if(this.submitEvent()){this.close()}};DamoDialog.prototype.saveRange=function(){this.editor.focus();this.linkRange=damoUtil.getRange();this.selection=damoUtil.getSelection()};DamoDialog.prototype.undoRecord=function(a){this.editor.undoRecord()};function damoDialogLink(){this.init=function(a){this.initialize(a);return this};this.open=function(){var c="<div id='damoDialogMain' class='damoDialogMain'><label class='label'>URL</label><input type='text' id='damoUrl' class='textBox' value='http://'><p/><label class='label'>"+this.editor.DamoMessage.link.text+"</label><input type='text' id='damoUrlTitle' class='textBox'><p/><input type='checkbox' id='damoUrlNew' value='Y'> "+this.editor.DamoMessage.link.newWindow+"<p/></div><div id='damoDialogBottom' class='damoDialogBottom'><div class='damoSubmitBtn'>"+this.editor.DamoMessage.dialog.makeBtn+"</div> <div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.cancelBtn+"</div></div>";var b=damoUtil.getRange();this.link=rangeUtil.findTag(b.startContainer,"^A");if(!this.link&&b.collapsed){alert(this.editor.DamoMessage.link.msg);return}this.width="340px";this.title=this.editor.DamoMessage.buttons.link;this.show(c);if(this.link){damoUtil.getElm("damoUrl").value=this.link.getAttribute("href");damoUtil.getElm("damoUrlNew").checked=this.link.getAttribute("target")!==null;damoUtil.getElm("damoUrlTitle").value=this.link.getAttribute("title");var d=damoUtil.getElm("damoDialogBottom");var a=damoUtil.createElement("div",d,"damoControlBtn","click",this.unlinkClick.closure(this));a.innerHTML=this.editor.DamoMessage.link.unlink}};this.submitEvent=function(){var a=damoUtil.getElm("damoUrl");var c=damoUtil.getElm("damoUrlNew");var b=damoUtil.getElm("damoUrlTitle");if(this.link){this.link.setAttribute("href",a.value);this.link.setAttribute("target",c.checked?"blank_":"");return}var d=this.linkRange.extractContents();var e=damoUtil.createElement("A");if(d.textContent===""){e.appendChild(d)}else{e.innerHTML=d.textContent;e.setAttribute("title",d.textContent)}e.setAttribute("href",a.value);if(c.checked){e.setAttribute("target","blank_")}if(b.value){e.setAttribute("title",b.value)}this.linkRange.deleteContents();this.linkRange.insertNode(e);this.undoRecord(e);return true};this.unlinkClick=function(){damoUtil.setSelection2(this.selection,this.linkRange,this.link);document.execCommand("unlink",false,null);this.editor.undoRecord();this.close()}}damoDialogLink.prototype=new DamoDialog();function damoDialogChar(){var a=["｝〔〕〈〉《》「」『』【】‘’“”、。·‥…§※☆★○●◎◇◆□■△▲▽▼◁◀▷▶♤♠♡♥♧♣⊙◈▣◐◑▒▤▥▨▧▦▩±×÷≠≤≥∞∴°′″∠⊥⌒∂≡≒≪≫√∽∝∵∫∬∈∋⊆⊇⊂⊃∪∩∧∨￢⇒⇔∀∃´～ˇ˘˝˚˙¸˛¡¿ː∮∑∏♭♩♪♬㉿→←↑↓↔↕↗↙↖↘㈜№㏇™㏂㏘℡♨☏☎☜☞¶†‡®ªº♂♀","½⅓⅔¼¾⅛⅜⅝⅞¹²³⁴ⁿ₁₂₃₄ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅰⅱⅲⅳⅴⅵⅶⅷⅸⅹ￦$￥￡€℃A℉￠¤‰㎕㎖㎗ℓ㎘㏄㎣㎤㎥㎦㎙㎚㎛㎜㎝㎞㎟㎠㎡㎢㏊㎍㎎㎏㏏㎈㎉㏈㎧㎨㎰㎱㎲㎳㎴㎵㎶㎷㎸㎹㎀㎁㎂㎃㎄㎺㎻㎼㎽㎾㎿㎐㎑㎒㎓㎔Ω㏀㏁㎊㎋㎌㏖㏅㎭㎮㎯㏛㎩㎪㎫㎬㏝㏐㏓㏃㏉㏜㏆","㉠㉡㉢㉣㉤㉥㉦㉧㉨㉩㉪㉫㉬㉭㉮㉯㉰㉱㉲㉳㉴㉵㉶㉷㉸㉹㉺㉻ⓐⓑⓒⓓⓔⓕⓖⓗⓘⓙⓚⓛⓜⓝⓞⓟⓠⓡⓢⓣⓤⓥⓦⓧⓨⓩ①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮㈀㈁㈂㈃㈄㈅㈆㈇㈈㈉㈊㈋㈌㈍㈎㈏㈐㈑㈒㈓㈔㈕㈖㈗㈘㈙㈚㈛⒜⒝⒞⒟⒠⒡⒢⒣⒤⒥⒦⒧⒨⒩⒪⒫⒬⒭⒮⒯⒰⒱⒲⒳⒴⒵⑴⑵⑶⑷⑸⑹⑺⑻⑼⑽⑾⑿⒀⒁⒂"];this.init=function(b){this.initialize(b);this.activeInx=0;return this};this.open=function(){var d="<div id='damoTab' class='damoTab'><div id='damoTabHead0'class='damoTabHead'>"+this.editor.DamoMessage.specialChar.tabHead1+"</div><div id='damoTabHead1' class='damoTabHead'>"+this.editor.DamoMessage.specialChar.tabHead2+"</div><div id='damoTabHead2' class='damoTabHead'>"+this.editor.DamoMessage.specialChar.tabHead3+"</div><div id='damoTabBody' class='damoTabBody'></div></div><div class='damoDialogBottom'><input type='text' id='damoSelectChar' class='damoSelectChar'/><div class='damoSubmitBtn'>"+this.editor.DamoMessage.dialog.confirmBtn+"</div><div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.cancelBtn+"</div></div>";this.width="500px";this.title=this.editor.DamoMessage.buttons.specialChar;this.show(d);this.damoTabChange(0);this.damoSelectChar=damoUtil.getElm("damoSelectChar");for(var c=0;c<3;c++){var b=damoUtil.getElm("damoTabHead"+c);damoUtil.addEvent(b,"click",this.damoTabChange.closure(this,c.toString()))}};this.submitEvent=function(){if(this.damoSelectChar.value===""){return false}var b=document.createTextNode(this.damoSelectChar.value);this.linkRange.insertNode(b);damoUtil.setSelection2(this.selection,this.linkRange,b);this.undoRecord(b);return true};this.damoTabChange=function(d){var e=damoUtil.getElm("damoTabBody");damoUtil.removeAllChild(e);for(var b=0;b<a[d].length;b++){if(a[d][b]===","){continue}var c=damoUtil.createElement("div",e,"damoTabItem");c.innerText=a[d][b];damoUtil.addEvent(c,"click",this.damoTabItemClick.closure(c))}damoUtil.removeClass(damoUtil.getElm("damoTabHead"+this.activeInx),"damoTabActive");damoUtil.addClass(damoUtil.getElm("damoTabHead"+d),"damoTabActive");this.activeInx=d};this.damoTabItemClick=function(){var c=damoUtil.getElm("damoSelectChar");c.value+=this.innerText;if(c.createTextRange){var b=c.createTextRange();b.move("character",c.value.length);b.select()}else{if(c.selectionStart||c.selectionStart=="0"){c.selectionStart=c.value.length;c.selectionEnd=c.value.length;c.focus()}}}}damoDialogChar.prototype=new DamoDialog();function damoDialogEmoticon(){this.init=function(a){this.initialize(a);return this};this.open=function(){var b="<div id='damoDialogMain' class='damoDialogMain'></div><div id='damoDialogBottom' class='damoDialogBottom'><div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.closeBtn+"</div></div>";this.width="500px";this.title=this.editor.DamoMessage.buttons.emoticon;this.show(b);var c=damoUtil.getElm("damoDialogMain");for(var a=1;a<79;a++){var d=damoUtil.createElement("div",c,"damoEmoticonItem");damoUtil.setStyle(d,{"background-image":"url('"+damoScriptPath+"images/emoticon/icon"+a+".gif')"});damoUtil.addEvent(d,"click",this.itemClick.closure(this,d))}};this.itemClick=function(c){var b=damoUtil.getStyle(c,"background-image");var a=damoUtil.createElement("IMG");a.setAttribute("src",b.replace(/(url\(|\)|")/g,""));a.setAttribute("title","Emoticon");a.setAttribute("alt","Emoticon");this.linkRange.insertNode(a);damoUtil.setSelection2(this.selection,this.linkRange,a);this.undoRecord(a);this.close()}}damoDialogEmoticon.prototype=new DamoDialog();function damoDialogImage(){var a=null;var d=null;var b=null;var e=null;this.init=function(f){this.initialize(f);return this};this.open=function(){var g="<div id='damoDialogMain' class='damoDialogMain'><div><label class='label'>"+this.editor.DamoMessage.image.file+"</label><input type='file' id='damoImgFile' name='damoImgFile' accept='image/*' class='textBox'/></div><br/><div><label class='label'>"+this.editor.DamoMessage.image.imgAlt+"</label><input type='text' id='damoImgTitle' class='textBox'/></div><br/><div><label class='label'>"+this.editor.DamoMessage.image.imgDesc+"</label><input type='text' id='damoImgAlt' class='textBox'/></div></div><div id='damoDialogBottom' class='damoDialogBottom'><div class='damoSubmitBtn'>"+this.editor.DamoMessage.dialog.confirmBtn+"</div> <div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.cancelBtn+"</div></div>";this.width="340px";this.title=this.editor.DamoMessage.buttons.image;this.show(g);a=this.editor.activeElement;if(a&&a.nodeName==="IMG"){var f=damoUtil.getElm("damoImgFile");var h=damoUtil.createElement("span",f.parentNode,"imageFile");h.innerHTML=a.getAttribute("src");h.setAttribute("title",a.src);damoUtil.getElm("damoImgTitle").value=a.getAttribute("title");damoUtil.getElm("damoImgAlt").value=a.getAttribute("alt")}else{a=null}};this.submitEvent=function(){if(damoImgFile.value!==""&&damoImgFile.files&&damoImgFile.files[0].size>this.editor.options.filesize){alert(this.editor.DamoMessage.msg.filesize);return false}d=damoUtil.getElm("damoImgTitle").value;b=damoUtil.getElm("damoImgAlt").value;if(damoImgFile.value===""){if(a){a.setAttribute("title",d);a.setAttribute("alt",b);this.undoRecord(a);damoUtil.setSelectionControl(a);return true}return false}var g=damoUtil.createElement("div",damoImgFile.parentNode,"progressbar4VideoFld");var f=damoUtil.createElement("div",g,"progressbar4Video");damoUtil.setStyle(f,{width:"0%"});e={obj:this,range:this.linkRange};if(damoImgFile.files){damoFileUploadByAjax(damoImgFile,this.editor.options.uploadURL,this.uploadResult,f)}else{damoFileUpload(damoImgFile,this.editor.options.uploadURL,this.uploadResult)}return false};this.uploadResult=function(f){if(!a){a=damoUtil.createElement("IMG");e.range.insertNode(a);e.obj.editor.focus();var h=damoUtil.getSelection();var g=damoUtil.getRange();damoUtil.setSelection2(h,g,a)}a.setAttribute("src",f);if(d){a.setAttribute("title",d)}if(d){a.setAttribute("alt",b)}damoUtil.setStyle(a,{"max-width":"100%"});damoUtil.addEvent(a,"load",c);e.obj.close()};var c=function(){e.obj.undoRecord(a)}}damoDialogImage.prototype=new DamoDialog();function damoDialogFind(){this.init=function(a){this.initialize(a);if(!this.damoFind){this.damoFind=new DamoFind(this.editor)}return this};this.open=function(){var a="<div id='damoDialogMain' class='damoDialogMain'><div><label class='label'>"+this.editor.DamoMessage.find.findWord+"</label><input type='text' id='damoFindWord' class='textBox'/></div><br/><div><label class='label'>"+this.editor.DamoMessage.find.replaceWord+"</label><input type='text' id='damoReplaceWord' class='textBox'/></div><div><label class='label'></label><label><input type='checkbox' id='damoMatchcase' value='0'/> "+this.editor.DamoMessage.find.matchcase+"</label></div></div><div id='damoDialogBottom' class='damoDialogBottom'><div id='damoFindBtn' class='damoControlBtn'>"+this.editor.DamoMessage.find.findBtn+"</div><div id='damoReplaceBtn' class='damoControlBtn'>"+this.editor.DamoMessage.find.replaceBtn+"</div><div class='damoSubmitBtn'>"+this.editor.DamoMessage.find.replaceAllBtn+"</div> <div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.closeBtn+"</div></div>";this.width="340px";this.title=this.editor.DamoMessage.buttons.find;this.show(a);this.selection=null;this.damoFindWord=damoUtil.getElm("damoFindWord");this.damoReplaceWord=damoUtil.getElm("damoReplaceWord");this.damoFindBtn=damoUtil.getElm("damoFindBtn");this.damoReplaceBtn=damoUtil.getElm("damoReplaceBtn");damoUtil.addEvent(this.damoFindBtn,"click",this.Find.closure(this));damoUtil.addEvent(this.damoReplaceBtn,"click",this.Replace.closure(this))};this.Find=function(){if(!damoUtil.inputCheck(this.damoFindWord,this.editor.DamoMessage.find.findMsg)){return false}var a=this.damoFind.setFindOption();if(this.selection){this.selection.addRange(this.linkRange)}this.damoFind.findNext(a);this.saveRange()};this.Replace=function(){if(!damoUtil.inputCheck(this.damoFindWord,this.editor.DamoMessage.find.findMsg)){return false}if(!damoUtil.inputCheck(this.damoReplaceWord,this.editor.DamoMessage.find.replaceMsg)){return false}var a=this.damoFind.setFindOption();if(this.selection){this.selection.addRange(this.linkRange)}this.damoFind.replaceNext(a,damoReplaceWord.value);this.saveRange();this.editor.undoRecord()};this.submitEvent=function(){if(!damoUtil.inputCheck(this.damoFindWord,this.editor.DamoMessage.find.findMsg)){return false}if(!damoUtil.inputCheck(this.damoReplaceWord,this.editor.DamoMessage.find.replaceMsg)){return false}var a=this.damoFind.setFindOption();this.damoFind.replaceAll(a,damoReplaceWord.value);this.editor.undoRecord();return true}}damoDialogFind.prototype=new DamoDialog();function damoDialogLayout(){this.init=function(b){this.initialize(b);return this};this.open=function(){var f="<div id='damoDialogMain' class='damoDialogMain'></div><div id='damoDialogBottom' class='damoDialogBottom'><div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.closeBtn+"</div></div>";this.width="340px";this.title=this.editor.DamoMessage.buttons.layout;this.show(f);var k=damoUtil.getElm("damoDialogMain");var l=damoUtil.createElement("table",k,"damoLayoutDialog");for(var e=0;e<4;e++){var g=damoUtil.createElement("tr",l);for(var d=0;d<4;d++){var c=e*4+d;var b=damoUtil.createElement("td",g,null,"click",this.LayoutClick.closureListener(this,c));var h=damoUtil.createElement("span",b,"editorLayoutItem");damoUtil.setStyle(h,{backgroundPosition:(c*-64)+"px 0px"})}}};var a=["<tr><td style='height: 50%;border-spacing: 10px;'>#msg#</td></tr><tr><td style='height: 50%;border-spacing: 10px;'>#msg#</td></tr>","<tr><td style='width: 50%'>#msg#</td><td style='width: 50%'>#msg#</td></tr>","<tr><td style='height: 33%'>#msg#</td></tr><tr><td style='height: 33%'>#msg#</td></tr><tr><td style='height: 33%'>#msg#</td></tr>","<tr><td style='width: 33%'>#msg#</td><td style='width: 33%'>#msg#</td><td style='width: 33%'>#msg#</td></tr>","<tr><td style='width: 50%; height: 50%;border-spacing: 10px;'>#msg#</td><td style='width: 50%; height: 50%;border-spacing: 10px;'>#msg#</td></tr><tr><td colspan='2' style='height: 50%;border-spacing: 10px;'>#msg#</td></tr>","<tr><td colspan='2' style='height: 50%;border-spacing: 10px;'>#msg#</td></tr><tr><td style='width: 50%; height: 50%;border-spacing: 10px;'>#msg#</td><td style='width: 50%; height: 50%;border-spacing: 10px;'>#msg#</td></tr>","<tr><td style='height: 50%;width: 50%'>#msg#</td><td rowspan='2'style='width: 50%'>#msg#</td></tr><tr><td style='height: 50%;width: 50%'>#msg#</td></tr>","<tr><td rowspan='2' style='width: 50%'>#msg#</td><td style='width: 50%;height: 50%;'>#msg#</td></tr><tr><td style='height: 50%;width: 50%'>#msg#</td></tr>","<tr><td style='width: 50%; height: 50%;border-spacing: 10px;'>#msg#</td><td style='width: 50%; height: 50%;border-spacing: 10px;'>#msg#</td></tr><tr><td style='width: 50%; height: 50%;border-spacing: 10px;'>#msg#</td><td style='width: 50%; height: 50%;border-spacing: 10px;'>#msg#</td></tr>","<tr><td style='height: 25%'>#msg#</td></tr><tr><td style='height: 25%'>#msg#</td></tr><tr><td style='height: 25%'>#msg#</td></tr><tr><td style='height: 25%'>#msg#</td></tr>","<tr><td colspan='2' style='height: 25%'>#msg#</td></tr><tr><td style='height: 50%;width:50%'>#msg#</td><td style='height: 50%;width:50%'>#msg#</td></tr><tr><td colspan='2' style='height: 25%'>#msg#</td></tr>","<tr><td colspan='3' style='height: 25%;border-spacing: 10px;'>#msg#</td></tr><tr><td style='width: 33%; height: 75%;'>#msg#</td><td style='width: 33%'>#msg#</td><td style='width: 33%'>#msg#</td></tr>","<tr><td style='height: 20%'>#msg#</td></tr><tr><td style='height: 20%'>#msg#</td></tr><tr><td style='height: 20%'>#msg#</td></tr><tr><td style='height: 20%'>#msg#</td></tr><tr><td style='height: 20%'>#msg#</td></tr>","<tr><td rowspan='4' style='height: 100%; width: 20%'>#msg#</td><td style='height: 25%'>#msg#</td></tr><tr><td style='height: 25%'>#msg#</td></tr><tr><td style='height: 25%'>#msg#</td></tr><tr><td style='height: 25%'>#msg#</td></tr>","<tr><td colspan='2' style='height: 25%'>#msg#</td></tr><tr><td rowspan='3' style='height: 100%; width: 20%'>#msg#</td><td style='height: 25%'>#msg#</td></tr><tr><td style='height: 25%'>#msg#</td></tr><tr><td style='height: 25%'>#msg#</td></tr>","<tr><td colspan='2' style='height: 25%'>#msg#</td></tr><tr><td rowspan='2' style='height: 100%; width: 20%'>#msg#</td><td style='height: 25%'>#msg#</td></tr><tr><td style='height: 25%'>#msg#</td></tr><tr><td colspan='2' style='height: 25%'>#msg#</td></tr>"];this.LayoutClick=function(d,b,e){if(!damoNewClick.apply(this)){return}this.editor.editor.innerHTML="<p><table class='damoLayoutInput damoLayoutDot' style='width: 100%; height: 700px; border-spacing: 10px;'>"+a[e].replace(/#msg#/g,"<p>"+this.editor.DamoMessage.layout.inputMsg+"</p>")+"</table></p>";this.editor.undoManager.clearUndo(this.editor.editor.innerHTML);this.close();var c=document.getElementsByClassName("damoLayoutInput");damoUtil.setSelectText(damoUtil.getSelection(),c[0].firstChild.firstChild.firstChild.firstChild)}}damoDialogLayout.prototype=new DamoDialog();var damoMakeUtil={makeColumn:function(l,j,k,d){var c=damoUtil.createElement("div",l,"settingField");var h=damoUtil.createElement("label",c,"inputSpinLabel");h.innerHTML=j;var f=damoUtil.createElement("div",c,"inputSpin");var e=damoUtil.createElement("input",f,"inputSpinTxt","keydown",damoUtil.onlyNumber);e.value=k;if(!d){var a=damoUtil.createElement("div",f,"spinButton");var g=damoUtil.createElement("span",a,"spinUp","click",this.spinClick.closure(e,1));var b=damoUtil.createElement("span",a,"spinDown","click",this.spinClick.closure(e,-1))}else{e.disabled=true}return e},makeTextColumn:function(c,b){var e=damoUtil.createElement("div",c,"settingField");var d=damoUtil.createElement("label",e,"inputSpinLabel");d.innerHTML=b;var a=damoUtil.createElement("input",e,"inputText");return a},makeSelectBox:function(d,b,a,c){var g=damoUtil.createElement("div",d,"settingField");var e=damoUtil.createElement("label",g,"inputSpinLabel");e.innerHTML=b;var f=new a();f.init(g,{});f.editor=c;return f},spinClick:function(a){this.value=damoUtil.parseInt(this.value)+a;if(this.value==="-1"){this.value="0"}}};function DamoDialogBasic4Table(){this.init=function(a){this.initialize(a);return this};this.open=function(a){}}DamoDialogBasic4Table.prototype=new DamoDialog();function DamoDialogTable(){this.open=function(c){var a="<div id='damoDialogMain' class='damoDialogMain'></div><div id='damoDialogBottom' class='damoDialogBottom'><div class='damoSubmitBtn'>"+this.editor.DamoMessage.dialog.confirmBtn+"</div> <div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.cancelBtn+"</div></div>";this.width="400px";this.title=this.editor.DamoMessage.table.title;this.show(a);this.selectedTable=c;var b=damoUtil.getElm("damoDialogMain");this.tableRow=damoMakeUtil.makeColumn(b,this.editor.DamoMessage.table.row,5,c);this.tableWidth=damoMakeUtil.makeColumn(b,this.editor.DamoMessage.table.width,"");this.tableColumn=damoMakeUtil.makeColumn(b,this.editor.DamoMessage.table.column,4,c);this.tableHeight=damoMakeUtil.makeColumn(b,this.editor.DamoMessage.table.height,"");this.tableBorder=damoMakeUtil.makeSelectBox(b,this.editor.DamoMessage.table.border,damoSelectBoxLinetype4Table,this.editor);this.tableBorderWidth=damoMakeUtil.makeColumn(b,this.editor.DamoMessage.table.borderWidth,1);this.borderColor=damoMakeUtil.makeSelectBox(b,this.editor.DamoMessage.table.borderColor,damoSelectBoxLineColor4Dialog,this.editor);this.bgColor=damoMakeUtil.makeSelectBox(b,this.editor.DamoMessage.table.bgColor,damoSelectBoxLineColor4Dialog,this.editor);this.tableCellSpace=damoMakeUtil.makeColumn(b,this.editor.DamoMessage.table.cellSpace,0);this.tableCellPad=damoMakeUtil.makeColumn(b,this.editor.DamoMessage.table.cellPad,1);this.borderColor.selectedItemEvent("#000000");this.bgColor.selectedItemEvent("#FFFFFF");var e=damoUtil.createElement("div",b,"settingField");var d=damoUtil.createElement("label",e);d.innerHTML=this.editor.DamoMessage.table.seperateBorder;this.collapse=damoUtil.createElement("input",d);this.collapse.type="checkbox";damoUtil.createElement("br",b);this.caption=damoMakeUtil.makeTextColumn(b,this.editor.DamoMessage.table.caption);this.summary=damoMakeUtil.makeTextColumn(b,this.editor.DamoMessage.table.summary);if(!c){return}this.tableRow.value=c.rows.length;this.tableWidth.value=damoUtil.getStyleI(c,"width");this.tableColumn.value=c.rows[0].cells.length;this.tableHeight.value=damoUtil.getStyleI(c,"height");this.tableBorder.setValue(damoUtil.getStyleA(c,"border-top-style"));this.tableBorderWidth.value=parseFloat(damoUtil.getStyleA(c,"border-top-width"));this.borderColor.setValue(damoUtil.getStyleA(c,"border-top-color"));this.bgColor.setValue(damoUtil.getStyleA(c,"background-color"));this.tableCellSpace.value=damoUtil.getStyleAI(c,"border-spacing");this.tableCellPad.value=damoUtil.getStyleAI(c,"padding");this.collapse.checked=damoUtil.getStyle(c,"border-collapse")!=="collapse";if(c.caption){this.caption.value=c.caption.innerHTML}this.summary.value=c.summary};this.submitEvent=function(){var b=this.tableRow.value;var a=this.tableColumn.value;if(b>60||a>40){alert(this.editor.DamoMessage.table.restrictCellMsg);return}if(this.selectedTable){return this.modifyTable()}return this.makeTable()};this.modifyTable=function(){damoUtil.setStyle(this.selectedTable,this.makeCSS(this.calWidth()));if(!this.selectedTable.caption){this.selectedTable.createCaption()}this.selectedTable.caption.innerHTML=this.caption.value;this.selectedTable.summary=this.summary.value;this.undoRecord(this.selectedTable);return true};this.makeTable=function(){var h=this.tableRow.value;var c=this.tableColumn.value;if(c==="0"||h==="0"){alert(this.editor.DamoMessage.table.InputMsg);return false}var b=this.calWidth();var g=rangeUtil.findTag(this.linkRange.startContainer,"TD");var e=Math.round(b/c)+C_PX;var d=this.makeCSS(b);var a={width:e,border:"1px solid black","word-break":"break-all"};var f=damoMakeTable(this.linkRange,c,h,d,a,this.summary.value,this.caption.value);this.undoRecord(f);return true};this.calWidth=function(){var a=this.tableWidth.value;if(damoUtil.parseInt(a)>0){a=a}else{var b=rangeUtil.findTag(this.linkRange.startContainer,"TD");a=b?parseInt(damoUtil.getStyle(b,"width"))-10:parseInt(damoUtil.getStyle(this.editor.editor,"width"))-30}return a};this.makeCSS=function(a){var c={width:a+C_PX,border:this.tableBorderWidth.value+"px "+this.tableBorder.getValue()+" "+this.borderColor.selectedValue,"background-color":this.bgColor.selectedValue,"border-spacing":this.tableCellSpace.value+C_PX,padding:this.tableCellPad.value+C_PX};var b=this.tableHeight.value;if(damoUtil.parseInt(b)>0){c.height=b+C_PX}c["border-collapse"]=this.collapse.checked?"separate":"collapse";return c}}DamoDialogTable.prototype=new DamoDialogBasic4Table();function damoMakeTable(e,k,h,f,c,g,n){var m=damoUtil.createElement("table",null);m.summary=g;damoUtil.setStyle(m,f);if(n){var l=m.createCaption();l.innerText=n}for(var d=0;d<h;d++){var o=damoUtil.createElement("tr",m);for(var b=0;b<k;b++){var a=damoUtil.createElement("td",o);damoUtil.setStyle(a,c);a.innerHTML="<p>"+damoUtil.getBlankChar()+"</p>"}}e.insertNode(m);m.rows[0].cells[0].focus();return m}function DamoDialogTableCell(){this.open=function(k){var b={left:this.editor.DamoMessage.tableCell.left,right:this.editor.DamoMessage.tableCell.right,center:this.editor.DamoMessage.tableCell.center,justify:this.editor.DamoMessage.tableCell.justify};var l={top:this.editor.DamoMessage.tableCell.top,middle:this.editor.DamoMessage.tableCell.middle,bottom:this.editor.DamoMessage.tableCell.bottom};var m={normal:this.editor.DamoMessage.tableCell.wordbreak_normal,"break-all":this.editor.DamoMessage.tableCell.wordbreak_all};this.border_arr={left:1,right:1,top:1,middle:1};var f="<div id='damoDialogMain' class='damoDialogMain'></div><div id='damoDialogBottom' class='damoDialogBottom'><div class='damoSubmitBtn'>"+this.editor.DamoMessage.dialog.confirmBtn+"</div> <div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.cancelBtn+"</div></div>";this.width="400px";this.title=this.editor.DamoMessage.tableCell.title;this.show(f);this.selectedCell=k.selectList[0];this.selectList=k.selectList;this.tableEditor=k;var n=damoUtil.getElm("damoDialogMain");this.align=this.makeSelectBoxTag(n,this.editor.DamoMessage.tableCell.align,b);this.wordbreak=this.makeSelectBoxTag(n,this.editor.DamoMessage.tableCell.wordbreak,m);this.valign=this.makeSelectBoxTag(n,this.editor.DamoMessage.tableCell.valign,l);damoUtil.createElement("hr",n);this.tableBorder=damoMakeUtil.makeSelectBox(n,this.editor.DamoMessage.tableCell.tableBorder,damoSelectBoxLinetype4Table,this.editor);this.tableBorderWidth=damoMakeUtil.makeColumn(n,this.editor.DamoMessage.tableCell.tableBorderWidth,1);this.borderColor=damoMakeUtil.makeSelectBox(n,this.editor.DamoMessage.tableCell.borderColor,damoSelectBoxLineColor4Dialog,this.editor);this.bgColor=damoMakeUtil.makeSelectBox(n,this.editor.DamoMessage.tableCell.bgColor,damoSelectBoxLineColor4Dialog,this.editor);this.tableCellPad=damoMakeUtil.makeColumn(n,this.editor.DamoMessage.tableCell.tableCellPad,1);var c=damoUtil.createElement("div",n,"settingField damoEditorCellProp");var a=damoUtil.createElement("div",c,"damoEditorCellPropOutline");var d=damoUtil.createElement("div",a,"damoEditorCellPropOutlineLeft");var j=damoUtil.createElement("div",d,"damoEditorCellPropHandlerTop");var e=damoUtil.createElement("div",d,"damoEditorCellPropHandlerBottom");this.propPreview=damoUtil.createElement("div",a,"damoEditorCellPropPreview");var h=damoUtil.createElement("div",a,"damoEditorCellPropHandlerLeft");var g=damoUtil.createElement("div",a,"damoEditorCellPropHandlerRight");damoUtil.addEvent(j,"click",this.previewClick.closureListener(this,"top"));damoUtil.addEvent(e,"click",this.previewClick.closureListener(this,"bottom"));damoUtil.addEvent(h,"click",this.previewClick.closureListener(this,"left"));damoUtil.addEvent(g,"click",this.previewClick.closureListener(this,"right"));this.getBorderStatus(this.selectedCell,j,"top");this.getBorderStatus(this.selectedCell,e,"bottom");this.getBorderStatus(this.selectedCell,h,"left");this.getBorderStatus(this.selectedCell,g,"right");this.align.value=damoUtil.getStyle(this.selectedCell,"text-align");this.wordbreak.value=damoUtil.getStyle(this.selectedCell,"word-break");this.valign.value=damoUtil.getStyle(this.selectedCell,"vertical-align");this.tableBorder.setValue(damoUtil.getStyleA(this.selectedCell,"border-top-style"));this.tableBorderWidth.value=parseFloat(damoUtil.getStyleA(this.selectedCell,"border-top-width"));this.borderColor.setValue(damoUtil.getStyleA(this.selectedCell,"border-top-color"));this.bgColor.setValue(damoUtil.getStyleA(this.selectedCell,"background-color"));this.tableCellPad.value=damoUtil.getStyleAI(this.selectedCell,"padding")};this.previewClick=function(d,b,a){var e=this.propPreview;var c="border-"+a+"-style";if(e.style[c]==="dotted"){e.style[c]="solid";b.style.backgroundColor="#C0C0C0";this.border_arr[a]=1}else{e.style[c]="dotted";b.style.backgroundColor="#FFFFFF";this.border_arr[a]=0}};this.getBorderStatus=function(e,b,a){var c="border-"+a+"-style";var d=this.propPreview;if(e.style[c]==="solid"){d.style[c]="solid";b.style.backgroundColor="#C0C0C0";this.border_arr[a]=1}else{d.style[c]="dotted";b.style.backgroundColor="#FFFFFF";this.border_arr[a]=0}};this.makeSelectBoxTag=function(e,c,b){var h=damoUtil.createElement("div",e,"settingField");var f=damoUtil.createElement("label",h,"inputSpinLabel");f.innerHTML=c;var a=damoUtil.createElement("select",h,"damoSelect");for(var d in b){var g=b[d];a.options[a.options.length]=new Option(g,d)}return a};this.submitEvent=function(){var b=this.makeCSS();for(var a=0;a<this.selectList.length;a++){var c=this.selectList[a];damoUtil.setStyle(c,b)}this.undoRecord(this.selectedCell);return true};this.close=function(){this.editor.editor.focus();this.damoDialog.parentNode.removeChild(this.damoDialog);this.tableEditor.resetSelectList(this.selectList);return true};this.makeCSS=function(){var b={"text-align":this.align.value,"word-break":this.wordbreak.value,"vertical-align":this.valign.value,border:this.tableBorderWidth.value+"px "+this.tableBorder.getValue()+" "+this.borderColor.selectedValue,"background-color":this.bgColor.selectedValue,padding:this.tableCellPad.value+C_PX};if(this.border_arr.left+this.border_arr.right+this.border_arr.top+this.border_arr.middle!==4){for(var a in this.border_arr){b["border-"+a+"-style"]=(this.border_arr[a]===1)?this.tableBorder.getValue():"none"}}return b}}DamoDialogTableCell.prototype=new DamoDialogBasic4Table();function damoSelectBoxLinetype4Table(){this.isMenu=false;this.items={0:"style='border: 1px'",1:"style='border: 1px solid'",2:"style='border: 1px dashed'",3:"style='border: 1px dotted'",4:"style='border: 3px double'"};this.itemsString=["","solid","dashed","dotted","double"];this.width="80px";this.selectedIndex=null;this.init=function(b,a){this.initialize(b,a);this.selectedItemEvent(0);return this};this.setItem=function(b,c,a){b.innerHTML="<HR "+c+">"};this.selectedItemEvent=function(a){this.selectedIndex=a;this.button.selecttitle.innerHTML="<HR "+this.items[a]+">"};this.getValue=function(){return this.itemsString[this.selectedIndex]};this.setValue=function(b){for(var a=0;a<this.itemsString.length;a++){if(this.itemsString[a]===b){this.selectedItemEvent(a);return}}this.selectedItemEvent(0)};this.damoSelectButtonClick=function(){this.selectedItemEvent(this.selectedValue)}}damoSelectBoxLinetype4Table.prototype=new DamoSelectBox();function damoSelectBoxLineColor4Dialog(){this.isMenu=false;this.init=function(b,a){this.initialize(b,a,false);return this};this.selectedItemEvent=function(a){if(parseInt(a)<100){a=this.items[a]}this.selectedValue=a;damoUtil.setStyle(this.button.selecttitle,{"background-image":"none","background-color":a})};this.setValue=function(a){this.selectedItemEvent(a)};this.damoSelectButtonClick=function(){}}damoSelectBoxLineColor4Dialog.prototype=new damoSelectBoxColor();function DamoFind(e){var a=false;var d=e;var f=function(j,h,m){if(!j||j.tagName=="BODY"||j.className=="damoEditor"){return null}var l=j;do{var n=l.data;if(n&&!a){n=n.toLowerCase()}if(l.nodeType===3&&n.indexOf(m,h)>-1){c(m,l,n.indexOf(m,h));return l}if(l.firstChild){for(var k=0;k<l.childNodes.length;k++){return f(l.childNodes[k],0,m)}}}while(l=l.nextSibling);return f(g(j),0,m)};var g=function(h){while(h=h.parentNode){if(h.className=="damoEditor"){return null}if(h.nextSibling){return h.nextSibling}}return null};var c=function(j,h,k){if(d.editor.scrollTop>h.parentNode.offsetTop||d.editor.scrollTop+parseInt(d.editor.style.height)<h.parentNode.offsetTop+20){d.editor.scrollTop=h.parentNode.offsetTop-20}damoUtil.setSelectText(damoUtil.getSelection(),h,k,k+j.length)};var b=function(h){if(h.endContainer.firstChild){return h.endContainer.firstChild}else{return h.endContainer}};this.findNext=function(j){var h=damoUtil.getRange();var k=b(h);if(!f(k,h.endOffset+1,j)){alert(d.DamoMessage.find.notFindMsg)}};this.replaceNext=function(m,h){var j=damoUtil.getRange();var o=b(j);var l=j.endOffset;var k=o.data.substring(j.startOffset,j.endOffset);if((a&&k===m)||(!a&&k.toLowerCase()===m)){l=j.startOffset+h.length;var n=o.data;o.data=n.substring(0,j.startOffset)+h+n.substring(j.endOffset,n.length)}if(!f(o,l,m)){alert(d.DamoMessage.find.notFindMsg)}};this.replaceAll=function(o,h){var n=d.editor.firstChild,l=0,j=0;var m=new RegExp(o,"g"+(!a?"i":""));while(n=f(n,j,o)){var p=n.data;var k=p.match(m);l+=k.length;n.data=p.replace(m,h);j=n.data.length}alert(d.DamoMessage.find.replacedMsg.replace("%1",l))};this.setFindOption=function(){var h=document.getElementById("damoFindWord").value;a=document.getElementById("damoMatchcase").checked;if(!a){h=h.toLowerCase()}d.editor.focus();return h}}function damoDialogExternalMedia(){this.init=function(a){this.initialize(a);return this};this.open=function(){var a="<div id='damoDialogMain' class='damoDialogMain'><div>"+this.editor.DamoMessage.externalMedia.desc+"</div><br/><div>"+this.editor.DamoMessage.externalMedia.source+"</div><br/><div><textarea id='damoMediaSource' style='width: 98%; height: 120px; border: 1px solid LightGray'></textarea></div><br/></div><div id='damoDialogBottom' class='damoDialogBottom'><div class='damoSubmitBtn'>"+this.editor.DamoMessage.dialog.confirmBtn+"</div> <div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.cancelBtn+"</div></div>";this.width="470px";this.title=this.editor.DamoMessage.buttons.externalMedia;this.show(a)};this.submitEvent=function(){this.editor.focus();var b=damoUtil.getElm("damoMediaSource");var a=damoUtil.createElement("P");a.innerHTML=b.value;if(a.firstChild){damoUtil.setStyle(a.firstChild,{"max-width":"95%"})}this.linkRange.insertNode(a);this.selection.addRange(this.linkRange);this.undoRecord(a);this.close()}}damoDialogExternalMedia.prototype=new DamoDialog();function damoDialogMedia(){var a=null;var b=null;this.init=function(c){this.initialize(c);return this};this.open=function(){var c="<div id='damoDialogMain' class='damoDialogMain'><div><label class='label'>"+this.editor.DamoMessage.image.file+"</label><input type='file' id='damoImgFile' name='damoImgFile' class='textBox' accept='.wmv, .mp4, .avi'/></div><br/><div id='damoDialogSub'></div><br/><div><label class='videoLabel'><input type='checkbox' name='damoVideoOption' value='autoplay' />"+this.editor.DamoMessage.mediaFile.autoplay+"</label><label class='videoLabel'><input type='checkbox' name='damoVideoOption' value='loop' />"+this.editor.DamoMessage.mediaFile.loop+"</label><label class='videoLabel'><input type='checkbox' name='damoVideoOption' value='controls' checked/>"+this.editor.DamoMessage.mediaFile.controls+"</label></div><br/></div><div id='damoDialogBottom' class='damoDialogBottom'><div class='damoSubmitBtn'>"+this.editor.DamoMessage.dialog.confirmBtn+"</div> <div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.cancelBtn+"</div></div>";this.width="380px";this.title=this.editor.DamoMessage.buttons.mediaFile;this.show(c);var d=damoUtil.getElm("damoDialogSub");this.videoWidth=damoMakeUtil.makeColumn(d,this.editor.DamoMessage.table.width,320,false);this.videoHeight=damoMakeUtil.makeColumn(d,this.editor.DamoMessage.table.height,240,false)};this.submitEvent=function(){var j=document.querySelectorAll("input[name=damoVideoOption]:checked");var d=0;for(var h=0;h<j.length;h++){if(j[h].value==="controls"){d++;break}}if(d===0){if(!confirm(this.editor.DamoMessage.mediaFile.controlsMsg)){return false}}var f=damoUtil.getElm("damoImgFile");if(f.value===""){return false}var e="";if(f.files){if(f.files[0].size>this.editor.options.filesize){alert(this.editor.DamoMessage.msg.filesize);return false}e=f.files[0].name}else{e=f.value}damoUtil.setStyle(f,{display:"none"});var g=damoUtil.createElement("div",f.parentNode,"progressbar4VideoFld");var c=damoUtil.createElement("div",g,"progressbar4Video");damoUtil.setStyle(c,{width:"0%"});b={obj:this,range:this.linkRange,ext:e.split(".").pop()};if(f.files){damoFileUploadByAjax(f,this.editor.options.uploadURL,this.uploadResult,c)}else{damoFileUpload(f,this.editor.options.uploadURL,this.uploadResult)}return false};this.uploadResult=function(c){var e=document.querySelectorAll("input[name=damoVideoOption]:checked");b.obj.editor.focus();var f=damoUtil.createElement("video");f.setAttribute("width",b.obj.videoWidth.value);f.setAttribute("height",b.obj.videoHeight.value);if(b.damoVideoTag==="video"){var g=damoUtil.createElement("source");f.appendChild(g);g.setAttribute("src",c);g.setAttribute("type","video/"+b.ext);for(var d=0;d<e.length;d++){if(e[d].checked){f.setAttribute(e[d].value,e[d].value)}}}else{f.setAttribute("src",c);f.setAttribute("type","video/x-ms-wmv");f.setAttribute("enablecontextmenu","0");for(var d=0;d<e.length;d++){if(e[d].checked){f.setAttribute(e[d].value,(e[d].checked?"1":"0"))}}}b.range.insertNode(f);b.obj.undoRecord(f);b.obj.close()}}damoDialogMedia.prototype=new DamoDialog();function damoSelectBoxMedia(){this.items={0:"externalMedia",1:"mediaFile"};var a=[],b=0;this.panelwidth=30;this.init=function(d,c){this.initialize(d,c);this.setPanel();return this};this.setItem=function(d,e,c){btn=new DamoButton(this.editor,editorConfig.buttons[e],false);d.appendChild(btn.button);a[c]=btn;damoUtil.removeClass(d,"damoSelectButtonItem")};this.selectedItemEvent=function(c){b=parseInt(c);var d=damoUtil.getStyle(a[b].button,"background-position-x");damoUtil.setStyle(this.button.selecttitle,{backgroundPosition:d+" 0px"})},this.damoSelectButtonClick=function(){a[b].button.click()}}damoSelectBoxMedia.prototype=new damoSelectButton();function damoDialogDocument(){var b=null;var g=null;var f=[];var a=[];var d=["left top","left center","left bottom","right top","right center","right bottom","center top","center center","center bottom"];var e=[];this.init=function(h){this.initialize(h);f=[["","scroll","fixed"],[this.editor.DamoMessage.documentBG.optionDefault,this.editor.DamoMessage.documentBG.optionScroll,this.editor.DamoMessage.documentBG.optionFixed]];a=[["no-repeat","repeat","repeat-x","repeat-y"],[this.editor.DamoMessage.documentBG.repeatNo,this.editor.DamoMessage.documentBG.repeat,this.editor.DamoMessage.documentBG.repeatX,this.editor.DamoMessage.documentBG.repeatY]];e=[d,this.editor.DamoMessage.documentBG.imgPosArr];return this};this.open=function(){var j="<div id='damoDialogMain' class='damoDialogMain'><div><label class='label'>"+this.editor.DamoMessage.buttons.image+"</label><input type='file' id='damoImgFile' name='damoImgFile' accept='image/*' class='textBox'/></div><br/><div><label class='label'>"+this.editor.DamoMessage.documentBG.imgOption+"</label><select id='damoImgOption' class='selectBox'></select></div><br/><div><label class='label'>"+this.editor.DamoMessage.documentBG.imgRepeat+"</label><select id='damoImgRepeat' class='selectBox'></select></div><br/><div><label class='label'>"+this.editor.DamoMessage.documentBG.imgPosition+"</label><select id='damoImgPosition' class='selectBox'></select></div><br/></div><div id='damoDialogBottom' class='damoDialogBottom'><div class='damoSubmitBtn'>"+this.editor.DamoMessage.dialog.confirmBtn+"</div> <div class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.cancelBtn+"</div></div>";this.width="340px";this.title=this.editor.DamoMessage.buttons.documentBG;this.show(j);this.imgOption=damoUtil.getElm("damoImgOption");c(this.imgOption,f);this.imgRepeat=damoUtil.getElm("damoImgRepeat");c(this.imgRepeat,a);this.imgPosition=damoUtil.getElm("damoImgPosition");c(this.imgPosition,e);var q=damoUtil.getElm("damoDialogMain");var h=damoUtil.createElement("div",q,"settingField_tmp");var o=damoUtil.createElement("label",h,"label");o.innerHTML=this.editor.DamoMessage.documentBG.bgCollor;this.bgColor=new damoSelectBoxLineColor4Dialog();this.bgColor.init(h,{});this.bgColor.editor=this.editor;this.bgColor.selectedItemEvent("#FFFFFF");damoUtil.addEvent(this.bgColor.button.selecttitle,"click",this.bgColor.damoSelectBoxClick.closure(this.bgColor));this.bgColor.setValue(damoUtil.getStyleA(this.editor.editor,"background-color"));this.imgOption.value=damoUtil.getStyle(this.editor.editor,"background-attachment");this.imgRepeat.value=damoUtil.getStyle(this.editor.editor,"background-repeat");this.imgPosition.value=damoUtil.getStyle(this.editor.editor,"background-position-x")+" "+damoUtil.getStyle(this.editor.editor,"background-position-y");var m=damoUtil.getElm("damoImgFile");var n=damoUtil.getStyle(this.editor.editor,"background-image");if(n!=="none"){var p=damoUtil.createElement("span",m.parentNode,"imageFile");p.innerHTML=n;p.setAttribute("title",n);var l=damoUtil.getElm("damoDialogBottom");var k=damoUtil.createElement("A",l,"damoControlBtn","click",this.removeButtonClick.closure(this));k.innerHTML=this.editor.DamoMessage.documentBG.imgRemove;k.setAttribute("href","#")}};this.removeButtonClick=function(){damoUtil.setStyle(this.editor.editor,{"background-color":"","background-image":"none"});this.close()};this.damoSelectButtonClick=function(){};function c(j,h){for(i=0;i<h[0].length;i++){var k=damoUtil.createElement("option");k.text=h[1][i];k.value=h[0][i];j.options.add(k)}}this.submitEvent=function(){damoUtil.setStyle(this.editor.editor,{"background-color":this.bgColor.selectedValue});damoUtil.setStyle(this.editor.editor,{"background-attachment":this.imgOption.value});damoUtil.setStyle(this.editor.editor,{"background-repeat":this.imgRepeat.value});damoUtil.setStyle(this.editor.editor,{"background-position":this.imgPosition.value});var h=damoUtil.getElm("damoImgFile");if(h.value===""){return true}_this=this;if(h.files){damoFileUploadByAjax(h,this.editor.options.uploadURL,this.uploadResult,null)}else{damoFileUpload(h,this.editor.options.uploadURL,this.uploadResult)}return true};this.uploadResult=function(h){damoUtil.setStyle(_this.editor.editor,{"background-image":"url('"+h+"')"})}}damoDialogDocument.prototype=new DamoDialog();

function TableEditor(){this.editor=null;this.tableCells=[];this.selectList=[];this.selectArea={};this.sCellPos={};this.selectingCell=false;this.startTD=null;this.selectedTable=null;this.useRibbon=damoUtil.isChrome||damoUtil.isEdge;damoUtil.addEvent(document,"mousemove",this.mousemove.closureListener(this));damoUtil.addEvent(document,"mousedown",this.mousedown.closureListener(this));damoUtil.addEvent(document,"mouseup",this.mouseup.closureListener(this));this.mouseMoveAction=0;this.tableResize={position:0,type:0,table:null};this.gripper=damoUtil.createElement("div",document.body);damoUtil.addClass(this.gripper,"gripper");damoUtil.addEvent(this.gripper,"mousedown",this.gripperMousedown.closureListener(this));damoUtil.addEvent(this.gripper,"dragover",damoUtil.preventDefault);damoUtil.addEvent(this.gripper,"drop",damoUtil.preventDefault)}TableEditor.prototype.undoRecord=function(b){if(!b){b=this.selectedTable}var a=damoEditors.findDamoEditorInPath(b);a.focus();a.undoRecord()};TableEditor.prototype.setRibbon=function(b){var a=b.getBoundingClientRect();var d=a.top+document.body.scrollTop+damoUtil.getStyleI(b,"height")-7;var c=a.left+document.body.scrollLeft+damoUtil.getStyleI(b,"width")-7;damoUtil.setStyle(this.ribbon,{left:c+C_PX,top:d+C_PX})};TableEditor.prototype.removeRibbon=function(){if(!this.ribbon){return}this.ribbon.parentNode.removeChild(this.ribbon);this.ribbon=null;this.selectedImage=null};TableEditor.prototype.mousedown=function(a){if(a.button===0&&this.useRibbon){if(a.target.nodeName==="IMG"){this.editor=damoEditors.findDamoEditorInPath(a.target);if(!this.editor){return}if(!this.ribbon){this.ribbon=damoUtil.createElement("div",document.body,"imageRibbon","mousedown",this.imageMousedown.closureListener(this));damoUtil.addEvent(this.ribbon,"mouseup",this.imageMouseup.closureListener(this))}this.selectedImage=a.target;this.setRibbon(this.selectedImage);return}else{if(this.ribbon===a.target){return}else{if(this.ribbon){this.removeRibbon()}}}}if(a.target.className==="damoContextMenuItemBody"){return}this.startTD=rangeUtil.findTagInPath(a.target,"TD");if(!this.startTD){if(a.target.className.indexOf&&a.target.className.indexOf("damoContextMenuItem")===-1){this.unmarkSelectCell();this.selectList=[]}return}this.editor=damoEditors.findDamoEditorInPath(this.startTD);if(!this.editor){return}this.selectedTable=rangeUtil.findTagInPath(this.startTD,"TABLE");this.setTableCells();if(a.which===3){a.preventDefault();return}this.unmarkSelectCell();this.selectList=[this.startTD];this.selectingCell=true;this.sCellPos=this.getCellPosition(this.startTD)};TableEditor.prototype.imageMousedown=function(a){this.imageResizing=true;this.imagePos={x:a.pageX,y:a.pageY}};TableEditor.prototype.imageMouseup=function(a){this.imageResizing=false;this.setRibbon(this.selectedImage);this.editor.undoRecord()};TableEditor.prototype.mousemove=function(b){if(this.imageResizing&&this.ribbon){damoUtil.setStyle(this.ribbon,{left:(b.pageX-3)+C_PX,top:(b.pageY-3)+C_PX});damoUtil.setStyle(this.selectedImage,{width:(damoUtil.getStyleI(this.selectedImage,"width")+b.pageX-this.imagePos.x)+C_PX,height:(damoUtil.getStyleI(this.selectedImage,"height")+b.pageY-this.imagePos.y)+C_PX});this.imagePos={x:b.pageX,y:b.pageY};return}if(!this.selectingCell){this.mousemove4CellResizing(b);return}this.unmarkSelectCell();var a=rangeUtil.findTagInPath(b.target,"TD");if(!a||a===this.startTD){return}damoUtil.getSelection().removeAllRanges();var c=this.getCellPosition(a);if(!c){return}this.selectArea={x1:Math.min(this.sCellPos.x,this.sCellPos.x_span,c.x,c.x_span),y1:Math.min(this.sCellPos.y,this.sCellPos.y_span,c.y,c.y_span),x2:Math.max(this.sCellPos.x,this.sCellPos.x_span,c.x,c.x_span),y2:Math.max(this.sCellPos.y,this.sCellPos.y_span,c.y,c.y_span)};this.selectArea=this.searchSelectArea(this.selectArea);this.selectCell(this.selectArea);this.markSelectCell()};TableEditor.prototype.mouseup=function(a){if(a.button!==0||a.target.className==="damoContextMenuItemBody"){return}if(this.tableResize.type>0){if(this.tableResize.type===1){this.resizeTableColumnWidth(this.tableResize.targetCell,a.pageX-this.tableResize.position)}else{this.resizeTableRowHeight(this.tableResize.targetCell,a.pageY-this.tableResize.position)}this.tableResize.type=0;damoUtil.removeClass(this.gripper,"gripperShow");return}if(!this.selectingCell){return}this.selectingCell=false;if(this.selectList.length<2){this.selectArea={};if(this.editor){this.editor.buttonsDisable(false)}}else{this.editor.buttonsDisable(false,"image,link,table,sChar")}};TableEditor.prototype.getStyleI=function(c,b){var a=this.getAttributeI(c,b);if(a>1){return a}if(c.style[b]){return parseInt(c.style[b])}return parseInt(damoUtil.getStyle(c,b))};TableEditor.prototype.setTableCells=function(){var j=this.selectedTable.rows[0],f=0,d=0;for(var c=0;c<j.cells.length;c++){f+=this.getAttributeI(j.cells[c],"colSpan")}this.tableCells=[f];d=this.selectedTable.rows.length;for(var c=0;c<f;c++){this.tableCells[c]=new Array(d)}for(var k=0;k<d;k++){j=this.selectedTable.rows[k];if(!j){continue}var l=-1,m=0;var b=j.cells[m];while(b){l++;if(!this.tableCells[l]){break}if(this.tableCells[l][k]){continue}var e=this.getAttributeI(b,"colSpan");var h=this.getAttributeI(b,"rowSpan");for(var g=0;g<h;g++){for(var a=0;a<e;a++){this.tableCells[l+a][k+g]=b}}b=j.cells[++m]}}};TableEditor.prototype.getCellSpan=function(c){var a=parseInt(c.getAttribute("colSpan"))-1||0;var b=parseInt(c.getAttribute("rowSpan"))-1||0;if(b<0){b=0}return{col:a,row:b}};TableEditor.prototype.getCellPosition=function(e){for(var a=0;a<this.tableCells.length;a++){for(var d=0;d<this.tableCells[a].length;d++){if(this.tableCells[a][d]===e){var c=this.getAttributeI(e,"colSpan");var b=this.getAttributeI(e,"rowSpan");return{x:a,y:d,x_span:a+c-1,y_span:d+b-1}}}}return{x:0,y:0,x_span:0,y_span:0}};TableEditor.prototype.markSelectCell=function(){for(var a=0;a<this.selectList.length;a++){damoUtil.addClass(this.selectList[a],"damoSelectedCell")}};TableEditor.prototype.unmarkSelectCell=function(){for(var a=0;a<this.selectList.length;a++){damoUtil.removeClass(this.selectList[a],"damoSelectedCell")}};TableEditor.prototype.selectCell=function(c){this.selectList=[];for(var a=c.x1;a<=c.x2;a++){for(var d=c.y1;d<=c.y2;d++){var b=this.tableCells[a][d];if(this.selectList.indexOf(b)===-1){this.selectList.push(b)}}}};TableEditor.prototype.searchSelectArea=function(k){var m=k.x1,l=k.y1,b=0,p=0;for(var n=k.x1;n<=k.x2;n++){for(var j=k.y1;j<=k.y2;j++){var c=this.tableCells[n][j];var o=this.getCellSpan(c);var e=-1,d=1,a=-1,g=1;for(var f=n;f>=n-o.col;f--){if(!this.tableCells[f]||c!==this.tableCells[f][j]){break}d--}for(var f=n;f<=n+o.col;f++){if(!this.tableCells[f]||c!==this.tableCells[f][j]){break}e++}for(var f=j;f>=j-o.row;f--){if(!this.tableCells[n][f]||c!==this.tableCells[n][f]){break}g--}for(var f=j;f<=j+o.row;f++){if(!this.tableCells[n][f]||c!==this.tableCells[n][f]){break}a++}if(m>n+d){m=n+d}if(b<n+e){b=n+e}if(l>j+g){l=j+g}if(p<j+a){p=j+a}}}var h={x1:m,y1:l,x2:b,y2:p};if(k.x1===m&k.y1===l&k.x2===b&k.y2===p){return h}else{return this.searchSelectArea(h)}};TableEditor.prototype.searchSelectMinMax=function(){var b=9999,a=9999,e=0,d=0;for(var c=0;c<this.selectList.length;c++){var g=this.selectList[c];var f=this.getCellPosition(g);b=Math.min(b,f.x);e=Math.max(e,f.x,f.x_span);a=Math.min(a,f.y);d=Math.max(d,f.y,f.y_span)}return{x1:b,y1:a,x2:e,y2:d}};TableEditor.prototype.cellMerge=function(){if(this.selectList.length<2){return}var d=this.selectList[0];this.selectArea=this.searchSelectMinMax();var b=0,c=0,f;for(var a=this.selectArea.x1;a<=this.selectArea.x2;a++){var g=this.tableCells[a][this.selectArea.y1];if(g===f){continue}b+=this.getStyleI(g,"width");f=g}for(var a=this.selectArea.y1;a<=this.selectArea.y2;){c+=this.getStyleI(this.tableCells[this.selectArea.x1][a],"height");a+=this.getAttributeI(this.tableCells[this.selectArea.x1][a],"rowspan")}for(var a=1;a<this.selectList.length;a++){this.selectList[a].parentNode.removeChild(this.selectList[a])}var e=this.selectArea.y2-this.selectArea.y1+1;d.setAttribute("rowspan",e);d.setAttribute("colspan",this.selectArea.x2-this.selectArea.x1+1);damoUtil.setStyle(d,{width:b+C_PX,height:c+C_PX});this.selectList=[];this.selectList.push(d);this.rearrangeTR(d.parentNode,e);this.setTableCells();this.undoRecord()};TableEditor.prototype.rearrangeTR=function(e,d){var b=0;for(var a=0;a<e.cells.length;a++){if(this.getAttributeI(e.cells[a],"rowspan")===d){b++}}if(e.cells.length===b){for(var a=0;a<e.cells.length;a++){e.cells[a].removeAttribute("rowspan")}for(var a=e.rowIndex+1;a<e.rowIndex+d;){var c=this.selectedTable.rows[a];if(c.cells.length===0){c.parentNode.removeChild(c)}else{a++}if(a===this.selectedTable.rows.length){break}}}};TableEditor.prototype.splitColumn=function(){if(this.selectList.length===0){return}this.unmarkSelectCell();var k=this.selectList[0];var a=0,q=0;for(var h=0;h<this.selectList.length;h++){var d=this.selectList[h];var j=this.getAttributeI(d,"colSpan");var e=Math.round(j/2);if(j===1){var m=this.getCellPosition(d);for(var l=0;l<this.tableCells[0].length;){var c=this.tableCells[m.x][l];var p=this.getAttributeI(c,"colSpan");c.setAttribute("colSpan",p+1);l+=this.getAttributeI(c,"rowSpan")}d.setAttribute("colSpan",1)}else{d.setAttribute("colSpan",j-e)}var o=this.cloneNode(d);o.setAttribute("colSpan",e);o.setAttribute("rowSpan",this.getAttributeI(d,"rowSpan"));var b=this.getStyleI(d,"width");var g=Math.round(b/2);damoUtil.setStyleNremoveA(d,{width:g+"px"});damoUtil.setStyleNremoveA(o,{width:(b-g)+"px"});d.parentNode.insertBefore(o,d.nextSibling);var f=this.getCellPositionInTable(o);if(a<f.x){a=f.x}if(q<f.y){q=f.y}}this.setTableCells();var n=this.getCellPosition(k);var f=this.getCellPosition(o);this.selectArea=this.searchSelectArea({x1:n.x,y1:n.y,x2:Math.max(f.x,f.x_span),y2:q});this.selectCell(this.selectArea);this.markSelectCell();this.undoRecord()};TableEditor.prototype.sameHeight=function(){this.unmarkSelectCell();var e=0,b=0,a=0;if(this.selectList.length>1){var d=this.searchSelectMinMax();b=this.selectArea.y1;a=this.selectArea.y2}else{a=this.tableCells[0].length-1}for(var f=b;f<=a;){e+=damoUtil.getStyleAI(this.tableCells[0][f],"height");f+=this.getAttributeI(this.tableCells[0][f],"rowspan")}e=Math.round(e/(a-b+1));for(var f=b;f<=a;f++){for(var c=0;c<this.tableCells.length;c++){var g=this.getAttributeI(this.tableCells[c][f],"rowSpan");damoUtil.setStyle(this.tableCells[c][f],{height:(e*g)+C_PX})}}if(this.selectList.length>1){this.markSelectCell()}this.undoRecord()};TableEditor.prototype.sameWidth=function(){this.unmarkSelectCell();var e=0,b=0,a=0;if(this.selectList.length>1){var d=this.searchSelectMinMax();b=this.selectArea.x1;a=this.selectArea.x2}else{a=this.tableCells.length-1}for(var f=b;f<=a;){e+=damoUtil.getStyleAI(this.tableCells[f][0],"width");f+=this.getAttributeI(this.tableCells[f][0],"colspan")}e=Math.round(e/(a-b+1));for(var f=b;f<=a;f++){for(var c=0;c<this.tableCells[f].length;c++){var g=this.getAttributeI(this.tableCells[f][c],"colspan");damoUtil.setStyle(this.tableCells[f][c],{width:(e*g)+C_PX})}}if(this.selectList.length>1){this.markSelectCell()}this.undoRecord()};TableEditor.prototype.getCellPositionInTable=function(e){var a=e.cellIndex;var d=e.parentNode.rowIndex;var c=this.getAttributeI(e,"colSpan");var b=this.getAttributeI(e,"rowSpan");return{x:a,y:d,x_span:a+c-1,y_span:d+b-1}};TableEditor.prototype.getAttributeI=function(b,a){return parseInt(b.getAttribute(a),10)||1};TableEditor.prototype.cloneNode=function(b){var a=b.cloneNode(false);a.innerHTML=damoUtil.getBlankChar();return a};TableEditor.prototype.splitRow=function(){if(this.selectList.length===0){return}this.unmarkSelectCell();var a,l,v,n,g=0,h;for(var u=0;u<this.selectList.length;u++){l=this.selectList[u];if(this.getAttributeI(l,"rowSpan")>1){continue}a=l.parentNode;n=damoUtil.createElement("tr");a.parentNode.insertBefore(n,a.nextSibling);h=this.getCellPosition(l);for(var m=0;m<this.tableCells.length;){v=this.tableCells[m][h.y];e=this.getAttributeI(v,"rowSpan");v.setAttribute("rowSpan",e+1);m+=this.getAttributeI(v,"colSpan")}g++}var z,f,d,b,e,k,p;var y=0,w=0,s,q;for(var u=0;u<this.selectList.length;u++){var l=this.selectList[u];e=this.getAttributeI(l,"rowSpan");f=Math.round(e/2);l.setAttribute("rowSpan",f);z=this.cloneNode(l);z.setAttribute("rowSpan",e-f);p=z;k=this.getAttributeI(l,"colSpan");z.setAttribute("colSpan",k);s=damoUtil.getStyleAI(l,"height");q=Math.round(s/2);damoUtil.setStyleNremoveA(l,{height:q+"px"});damoUtil.setStyle(z,{height:(s-q)+"px"});a=this.selectedTable.rows[l.parentNode.rowIndex+f];var c=a.cells;var A=null;d=this.getCellPosition(l);for(var t=0;t<c.length;t++){v=c[t];b=this.getCellPosition(v);if(d.x<b.x){A=v;break}}a.insertBefore(z,A);var o=this.getCellPositionInTable(z);if(y<d.x){y=d.x}if(w<o.y){w=o.y}}this.setTableCells();var r=this.getCellPosition(this.selectList[0]);if(this.selectArea&&this.selectArea.y2){this.selectArea.y2+=g}else{this.selectArea={x1:r.x,y1:r.y,x2:y,y2:w}}this.selectCell(this.selectArea);this.markSelectCell();this.undoRecord()};TableEditor.prototype.insertColumn=function(g){if(this.selectList.length===0){return}this.selectArea={};this.unmarkSelectCell();var j=this.selectList[0];var d=this.getCellPosition(j);var h=null,i=damoUtil.getStyle(j,"width");for(var e=0;e<this.tableCells[0].length;){var a=this.tableCells[d.x][e];var c=this.getAttributeI(a,"rowSpan");var b=this.getAttributeI(a,"colSpan");if(b>1){var f=this.getCellPosition(a);if(g==="left"&&d.x===f.x){h=this.cloneNode(a);h.setAttribute("rowSpan",c);h.setAttribute("colSpan",1);damoUtil.setStyle(h,{width:i});a.parentNode.insertBefore(h,a)}else{a.setAttribute("colSpan",b+1)}}else{h=this.cloneNode(a);a.parentNode.insertBefore(h,((g==="left")?a:a.nextSibling));h.setAttribute("rowSpan",c);damoUtil.setStyle(h,{width:i})}e+=c}this.undoRecord();this.setTableCells();this.selectList=[];this.selectList.push(j);j.focus()};TableEditor.prototype.insertRow=function(h){if(this.selectList.length===0){return}this.selectArea={};this.unmarkSelectCell();var j=this.selectList[0];var e=this.getAttributeI(j,"rowSpan");if(e>1&&h!=="over"){var f=this.getCellPosition(j);if(f.y+e<this.tableCells[0].length){j=this.tableCells[f.x][f.y+e];h="over"}}var d=j.parentNode;var a=damoUtil.createElement("tr");d.parentNode.insertBefore(a,((h==="over")?d:d.nextSibling));function i(m,o,n){var l=m.cloneNode(o);l.setAttribute("colSpan",n);l.setAttribute("rowSpan",1);var k=damoUtil.getStyle(o,"height");damoUtil.setStyle(l,{height:k});a.insertBefore(l,null)}var f=this.getCellPosition(j);var c,e;for(var g=0;g<this.tableCells.length;){var b=this.tableCells[g][f.y];c=this.getAttributeI(b,"colSpan");e=this.getAttributeI(b,"rowSpan");if(e>1){if(h==="over"&&d.rowIndex===b.parentNode.rowIndex){i(this,b,c)}else{b.setAttribute("rowSpan",e+1)}}else{i(this,b,c)}g+=c}this.undoRecord();this.setTableCells();this.selectList=[];this.selectList.push(j);j.focus()};TableEditor.prototype.deleteRow=function(){if(this.selectList.length===0){return}this.selectArea={};this.unmarkSelectCell();var i=this.selectList[0];var e=i.parentNode;var g=this.getCellPosition(i);var c,f,a=null;for(var h=0;h<this.tableCells.length;h++){var b=this.tableCells[h][g.y];f=this.getAttributeI(b,"rowSpan");if(f>1){a=b;break}}if(a){for(var h=0;h<this.tableCells.length;){var b=this.tableCells[h][g.y];f=this.getAttributeI(b,"rowSpan");c=this.getAttributeI(b,"colSpan");if(f>1){b.setAttribute("rowSpan",f-1);if(e.rowIndex===b.parentNode.rowIndex){var d=null;if(h+c<this.tableCells.length){d=this.tableCells[h+c][g.y+1];if(this.getAttributeI(d,"rowSpan")>1){d=null}}e.nextSibling.insertBefore(b,d)}}else{b.parentNode.removeChild(b)}h+=c}do{if(e.cells.length===0){e.parentNode.removeChild(e);break}}while(e=e.nextSibling)}else{e.parentNode.removeChild(e)}this.undoRecord();this.setTableCells();this.selectList=[]};TableEditor.prototype.deleteColumn=function(){if(this.selectList.length===0){return}this.selectArea={};this.unmarkSelectCell();var a=this.selectList[0];var f=this.getCellPosition(a);for(var e=0;e<this.tableCells[0].length;){var d=this.tableCells[f.x][e];var c=this.getAttributeI(d,"colSpan");if(c>1){d.setAttribute("colSpan",c-1)}else{d.parentNode.removeChild(d)}var b=this.getAttributeI(d,"rowSpan");e+=b}this.undoRecord();this.setTableCells();this.selectList=[]};TableEditor.prototype.removeTable=function(){var a=this.selectedTable.parentNode;a.removeChild(this.selectedTable);this.undoRecord(a)};var inc=0;TableEditor.prototype.mousemove4CellResizing=function(d){if(this.tableResize.type>0){if(this.tableResize.type===1){damoUtil.setStyle(this.gripper,{left:(d.pageX)+C_PX})}else{damoUtil.setStyle(this.gripper,{top:(d.pageY)+C_PX})}return false}if(d.target.nodeName!=="TD"){return false}this.mouseMoveAction=0;var b=rangeUtil.findTagInPath(d.target,"TD");if(!b||b.className.indexOf("tablePacker")>-1){damoUtil.setStyle(this.gripper,{display:"none"});return false}if(!rangeUtil.findTagInPathByClass(b,"editor")){return}this.tableResize.targetCell=b;var c=b.clientWidth+this.getStyleI(b,"border-left-width")+this.getStyleI(b,"border-right-width"),a=b.clientHeight+this.getStyleI(b,"border-top-width")+this.getStyleI(b,"border-bottom-width");if(d.offsetY<=3){if(b.parentNode.rowIndex===0){return false}this.setGriperPositionOfRow(b,d,1)}else{if(a-d.offsetY<=3){this.setGriperPositionOfRow(b,d,2)}else{if(c-d.offsetX<=3){this.setGriperPositionOfColumn(b,d,3)}else{if(d.offsetX<=3){if(b.cellIndex==0){return false}this.setGriperPositionOfColumn(b,d,4)}else{damoUtil.setStyle(this.gripper,{display:"none",cursor:"default",top:"-1px"})}}}}return false};TableEditor.prototype.getBeforeRow=function(b){this.selectedTable=this.tableResize.table;this.setTableCells();var a=this.getCellPosition(b);return this.tableCells[a.x][a.y-1]};TableEditor.prototype.getBeforeColumn=function(e){var d=this.getCellPosition(e);var a=this.tableCells[d.x-1][d.y];var b=this.getAttributeI(a,"colSpan");if(b===1){return a}var c=this.getBeforeColumnInOther(a,d.x-1,d.y);if(c){return c}return a};TableEditor.prototype.getBeforeColumnInOther=function(f,a,d){var c=null,b=1;for(var e=d+1;e<this.tableCells[0].length;e++){c=this.tableCells[a][e];b=this.getAttributeI(c,"colSpan");if(b===1){return c}}for(var e=d-1;e>=0;e--){c=this.tableCells[a][e];b=this.getAttributeI(c,"colSpan");if(b===1){return c}}return f};TableEditor.prototype.resizeTableColumnWidth=function(f,c){this.selectedTable=this.tableResize.table;this.setTableCells();if(this.mouseMoveAction===4){f=this.getBeforeColumn(f)}var j=this.getCellPosition(f);var d=this.getAttributeI(f,"colSpan");if(d>1){f=this.getBeforeColumnInOther(f,j.x+d-1,j.y);j=this.getCellPosition(f)}var a=(this.getStyleI(f,"width")+c)+C_PX;var k=f.parentNode;var h=f.cellIndex;var g=((h<k.cells.length-1)?(this.getStyleI(k.cells[h+1],"width")-c)+C_PX:null);for(var i=0;i<this.tableCells[0].length;){var e=this.tableCells[j.x][i];var b=null;if(j.x<this.tableCells.length-1){b=this.tableCells[j.x+1][i]}if(e!==b){damoUtil.setStyleNremoveA(e,{width:a});if(g&&b){damoUtil.setStyleNremoveA(b,{width:g})}}i+=this.getAttributeI(e,"rowSpan")}this.undoRecord()};TableEditor.prototype.resizeTableRowHeight=function(f,d){if(this.mouseMoveAction===1){f=this.getBeforeRow(f)}var e=f.parentNode;var c=[];for(var b=0;b<e.cells.length;b++){c.push(this.getStyleI(e.cells[b],"height"))}for(var b=0;b<e.cells.length;b++){var a=(c[b]+d)+C_PX;damoUtil.setStyleNremoveA(e.cells[b],{height:a})}this.undoRecord(e)};TableEditor.prototype.getElementPosition=function(d){var b=0;var a=0;var c="";while(d){if(d.className==="editor"){break}b+=d.offsetTop;a+=d.offsetLeft;d=d.offsetParent}return{top:b,left:a}};TableEditor.prototype.setGriperPositionOfColumn=function(a,b,c){this.mouseMoveAction=c;this.editor=damoEditors.findDamoEditorInPath(a);if(!this.editor){return}this.tableResize.table=rangeUtil.findTagInPath(a,"TABLE");var g=this.getElementPosition(this.tableResize.table);var f=2;var e=this.editor.position.top+g.top-this.editor.editor.scrollTop+35;var d=b.clientX-b.offsetX-f;if(this.mouseMoveAction===3){d+=a.clientWidth}damoUtil.setStyle(this.gripper,{width:(f*2)+C_PX,height:this.tableResize.table.offsetHeight+C_PX,left:d+C_PX,top:e+C_PX,display:"block",cursor:"col-resize"})};TableEditor.prototype.setGriperPositionOfRow=function(a,b,c){this.mouseMoveAction=c;this.editor=damoEditors.findDamoEditorInPath(a);if(!this.editor){return}this.tableResize.table=rangeUtil.findTagInPath(a,"TABLE");var f=this.getElementPosition(this.tableResize.table);var e=b.clientY+document.documentElement.scrollTop+document.body.scrollTop-this.getStyleI(this.gripper,"height")/2;var d=this.editor.position.left+f.left;damoUtil.setStyle(this.gripper,{width:this.tableResize.table.offsetWidth+C_PX,height:((1+1)*2)+C_PX,left:d+C_PX,top:e+C_PX,display:"block",cursor:"row-resize"})};TableEditor.prototype.gripperMousedown=function(a){if(a.button!==0||this.mouseMoveAction===0){return true}damoUtil.addClass(this.gripper,"gripperShow");if(this.mouseMoveAction>2){this.tableResize.type=1;this.tableResize.position=a.pageX}else{if(this.mouseMoveAction<3){this.tableResize.type=2;this.tableResize.position=a.pageY}}a.preventDefault();return false};TableEditor.prototype.selectTable=function(){damoUtil.setSelectionControl(this.selectedTable)};TableEditor.prototype.modifyTable=function(){this.unmarkSelectCell();this.selectList=[];var a=new DamoDialogTable().init(damoEditors.findDamoEditorInPath(this.selectedTable));a.open(this.selectedTable)};TableEditor.prototype.modifyCell=function(){this.unmarkSelectCell();var a=new DamoDialogTableCell().init(damoEditors.findDamoEditorInPath(this.selectedTable));a.open(this)};TableEditor.prototype.resetSelectList=function(a){this.selectList=a;this.markSelectCell()};TableEditor.prototype.damoTableLayout=function(){var a=new DamoDialogTableLayout().init(this.editor);a.open(this.selectedTable)};var damoMenuItems=[{icon:31,command:"addUp",text:"addUp",action:function(a){a.insertRow("over")}},{icon:32,command:"addDown",text:"addDown",action:function(a){a.insertRow("below")}},{icon:40,command:"splitRow",text:"splitRow",action:function(a){a.splitRow()}},{icon:36,command:"delRow",text:"delRow",action:function(a){a.deleteRow()}},{command:"seperate"},{icon:33,command:"addLeft",text:"addLeft",action:function(a){a.insertColumn("left")}},{icon:34,command:"addRight",text:"addRight",action:function(a){a.insertColumn("right")}},{icon:39,command:"splitCol",text:"splitCol",action:function(a){a.splitColumn()}},{icon:35,command:"delColumn",text:"delColumn",action:function(a){a.deleteColumn()}},{command:"seperate"},{icon:57,command:"sameHeight",text:"sameHeight",action:function(a){a.sameHeight()}},{icon:56,command:"sameWidth",text:"sameWidth",action:function(a){a.sameWidth()}},{command:"seperate"},{icon:41,command:"merge",text:"merge",action:function(a){a.cellMerge()}},{icon:43,command:"propCell",text:"propCell",action:function(a){a.modifyCell()}},{command:"seperate"},{icon:42,command:"propTable",text:"propTable",action:function(a){a.modifyTable()}},{command:"ie",text:"selectTable",action:function(a){a.selectTable()}},{icon:37,command:"delTable",text:"delTable",action:function(a){a.removeTable()}},{command:"seperate"},{icon:11,command:"delTable",text:"tableLayout",action:function(a){a.damoTableLayout()}}];var damoImageMenuItems=[{icon:38,command:"delete",text:"delete",action:function(a){a.editor.removeElement()}},{icon:9,command:"property",text:"property",action:damoModifyImage},{icon:49,command:"edit",text:"edit",action:damoEditImage}];function damoEditImage(b,g){var e=g.tableEditor.editor;var d=e.activeElement.src;var f=d.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);var a=window.location.href.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);if(!f||f[1]!==a[1]){alert(e.DamoMessage.image.msg.notEditor);return}if(d.indexOf("damoWebEditor")>0){alert(e.DamoMessage.image.msg.emoticon);return}var c=e.imageEditor;window.open(c,null,"width=990, height=595, help=no, resizable=no, status=no, center=yes, edge=raised")}function damoEditImage4Popup(){if(damoEditors.activeEditor.activeElement.nodeName!=="IMG"){return null}return damoEditors.activeEditor.activeElement}function damoModifyImage(a,b){b.tableEditor.editor.executeClick("image")}function DamoContextMenu(a){this.isshow=false;this.init=function(b){document.oncontextmenu=function(){return false};this.menuItems=null;this.tableEditor=b;this.contextMenu=damoUtil.createElement("div",document.body,"damoContextMenu");this.hide();damoUtil.addEvent(document.body,"mouseup",this.mouseup.closureListener(this))};this.show=function(b,e){var d=damoUtil.getStyleI(this.tableEditor.editor.toolbar,"width");var c=damoUtil.getStyleI(this.contextMenu,"width");console.log(d+":"+c+":"+b);if(c+b>d){b-=c}damoUtil.setStyle(this.contextMenu,{display:"",top:(e-80)+"px",left:b+"px"});this.isshow=true};this.hide=function(){damoUtil.setStyle(this.contextMenu,{display:"none"});this.isshow=false};this.itemClick=function(b){this.hide();b(this.targetNode?this.targetNode:this.tableEditor,this)};this.setMenuItem=function(d,j){this.menuItems=d;var h=this.contextMenu;while(h.firstChild){h.removeChild(h.firstChild)}for(var c in d){var e=d[c];if(e.command==="ie"&&!damoUtil.detectIE()){continue}var f=damoUtil.createElement("div",h);if("seperate"===e.command){damoUtil.addClass(f,"damoContextMenuSeperate");continue}damoUtil.addClass(f,"damoContextMenuItem");damoUtil.addEvent(f,"click",this.itemClick.closure(this,e.action));var g=damoUtil.createElement("div",f,"damoContextMenuItemHead");if(e.icon){damoUtil.setStyle(g,{backgroundPosition:(e.icon*-editorConfig.iconsize)+"px 0px"})}else{damoUtil.setStyle(g,{"background-image":"url('') !important"})}var b=damoUtil.createElement("div",f,"damoContextMenuItemBody");b.innerHTML=j[e.text]}}}DamoContextMenu.prototype.mouseup=function(d){if(d.button!==2){if(this.isshow){this.hide()}return}this.tableEditor.editor=damoEditors.findDamoEditorInPath(d.target);if(!this.tableEditor.editor){return}this.targetNode=null;if(d.target.nodeName==="IMG"){var e=damoUtil.getSelection();e.removeAllRanges();var b=damoImageMenuItems.slice();if(!this.tableEditor.editor.imageEditor){b.splice(2,1)}this.setMenuItem(b,this.tableEditor.editor.DamoMessage.imageMenu);this.show(d.pageX,d.pageY);return}var a=rangeUtil.findTagInPath(d.target,"TABLE");if(!a){if(this.isshow){this.hide()}return}if(this.tableEditor.selectList.length===0){this.tableEditor.selectList=[rangeUtil.findTagInPath(d.target,"TD")]}else{var c=rangeUtil.findTagInPath(this.tableEditor.selectList[0],"TABLE");if(a!==c){this.tableEditor.unmarkSelectCell();this.tableEditor.selectList=[rangeUtil.findTagInPath(d.target,"TD")]}}this.setMenuItem(damoMenuItems,this.tableEditor.editor.DamoMessage.tableMenu);this.show(d.pageX,d.pageY)};function DamoDialogTableLayout(){this.open=function(n){this.selectedTable=n;var l="<div id='damoDialogMain' class='damoDialogMain'></div><div id='damoDialogBottom' class='damoDialogBottom'><a href='#' class='damoCancelBtn'>"+this.editor.DamoMessage.dialog.closeBtn+"</a></div>";this.width="340px";this.height="390px";this.title=this.editor.DamoMessage.tableMenu.tableLayout;this.show(l);var p=damoUtil.getElm("damoDialogMain");this.borderColor=damoMakeUtil.makeSelectBox(p,this.editor.DamoMessage.table.borderColor,damoSelectBoxLineColor4Dialog,this.editor);this.bgColor=damoMakeUtil.makeSelectBox(p,this.editor.DamoMessage.table.bgColor,damoSelectBoxLineColor4Dialog,this.editor);this.borderColor.selectedItemEvent("#000000");this.bgColor.selectedItemEvent("#EAEAEA");var q=damoUtil.createElement("table",p,"damoLayoutDialog");for(var k=0;k<4;k++){var m=damoUtil.createElement("tr",q);for(var h=0;h<4;h++){var g=k*4+h;var f=damoUtil.createElement("td",m,null,"click",this.LayoutClick.closureListener(this,g));var o=damoUtil.createElement("span",f,"tableLayoutItem");damoUtil.setStyle(o,{backgroundPosition:(g*-62)+"px 0px"})}}};this.LayoutClick=function(m,k,f){var l=parseInt(f/4);f=f%4;c(this.selectedTable,this.borderColor.selectedValue);var n=this.bgColor.selectedValue;if(f===1){var p=this.selectedTable.rows[0];for(var h=0;h<p.cells.length;h++){p.cells[h].style.backgroundColor=n}}else{if(f>1){var q=this.selectedTable.rows;var o=f===2;for(var h=0;h<q.length;h++){if(o&(h%2)!==1){continue}for(var g=0;g<q[h].cells.length;g++){q[h].cells[g].style.backgroundColor=n}}}}e(this.selectedTable,l)};function e(g,f){if(f===1){b(g.rows[0])}else{if(f===2){b(g.rows[0]);d(g)}else{if(f===3){a(g)}}}}function c(k,m){var l={"border-collapse":"collapse","border-color":m};damoUtil.setStyle(k,l);var n=k.rows;var h={"background-color":"",border:"1px solid "+m};for(var g=0;g<n.length;g++){for(var f=0;f<n[g].cells.length;f++){damoUtil.setStyle(n[g].cells[f],h)}}}function b(h){var g={"border-bottom-width":"3px","border-bottom-style":"solid"};for(var f=0;f<h.cells.length;f++){damoUtil.setStyle(h.cells[f],g)}}function d(h){damoUtil.setStyle(h,{"border-left-width":"0px","border-right-width":"0px"});var k=h.rows;var f={"border-left-width":"0px"};var j={"border-right-width":"0px"};for(var g=0;g<k.length;g++){damoUtil.setStyle(k[g].cells[0],f);damoUtil.setStyle(k[g].cells[k[0].cells.length-1],j)}}function a(k){damoUtil.setStyle(k,{"border-left-width":"0px","border-right-width":"0px"});var l=k.rows;var h={"border-left-width":"0px","border-right-width":"0px"};for(var g=0;g<l.length;g++){for(var f=0;f<l[g].cells.length;f++){damoUtil.setStyle(l[g].cells[f],h)}}}}DamoDialogTableLayout.prototype=new DamoDialogBasic4Table();

var UndoStack=function(a){this.commands=[];this.stackPosition=-1;this.undoManager=a};UndoStack.prototype.execute=function(a){this._clearRedo();if(this.commands.length===200){this.commands.splice(0,1);this.stackPosition=198}a.execute();this.commands.push(a);this.stackPosition++;this.changed(this.undoManager)};function restoreRangePosition(e,d){d.focus();if(!e){return}var f=damoUtil.getSelection(),c=f.getRangeAt(0);var a,h,g=d,b=d;h=e.sC;a=h.length;while(a--&&g){g=g.childNodes[h[a]]}h=e.eC;a=h.length;while(a--&&g){b=b.childNodes[h[a]]}if(b.nodeType!==3){return}c.setStart(g,e.sO);c.setEnd(b,e.eO);f.removeAllRanges();f.addRange(c)}UndoStack.prototype.undo=function(b){var c=this.commands[this.stackPosition].oldValue;this.commands[this.stackPosition--].undo();this.changed(this.undoManager);if(this.stackPosition>-1){var a=this.commands[this.stackPosition].rangeInfo;restoreRangePosition(a,this.undoManager.editor.editor);this.undoManager.editor.activateButton()}return c};UndoStack.prototype.canUndo=function(){return this.stackPosition>=0};UndoStack.prototype.redo=function(){this.commands[++this.stackPosition].redo();var a=this.commands[this.stackPosition].rangeInfo;restoreRangePosition(a,this.undoManager.editor.editor);this.undoManager.editor.activateButton();this.changed(this.undoManager);return this.commands[this.stackPosition].newValue};UndoStack.prototype.canRedo=function(){return this.stackPosition<this.commands.length-1};UndoStack.prototype._clearRedo=function(){this.commands=this.commands.slice(0,this.stackPosition+1)};UndoStack.prototype.clearUndo=function(){this.commands=[];this.stackPosition=-1;this.changed(this.undoManager)};UndoStack.prototype.changed=function(a){};function getNodeIndex(b){var a=0;while(b=b.previousSibling){a++}return a}function saveRangePosition(d){var c=damoUtil.getRange();if(!c){return null}var e=c.startContainer,b=c.endContainer;var a=[];while(e!==d){a.push(getNodeIndex(e));e=e.parentNode}var f=[];while(b!==d){f.push(getNodeIndex(b));b=b.parentNode}return{sC:a,sO:c.startOffset,eC:f,eO:c.endOffset}}var EditCommand=function(b,a,c){this.editor=b;this.oldValue=a.replace(/damoSelectedCell/gi,"");this.newValue=c.replace(/damoSelectedCell/gi,"");this.rangeInfo=saveRangePosition(b)};EditCommand.prototype.execute=function(){};EditCommand.prototype.undo=function(){this.editor.innerHTML=this.oldValue};EditCommand.prototype.redo=function(){this.editor.innerHTML=this.newValue};var UndoManager=function(b,c,a){this.timer=null;this.isPressShortcuts=false;this.editor=a;this.undoBtn=b;this.redoBtn=c;this.stack=new UndoStack(this);this.stack.changed=this.changed;this.stack.changed(this);this.startValue=a.editor.innerHTML;if(b){damoUtil.addEvent(b.button,"click",this.undo_click.closure(this))}if(c){damoUtil.addEvent(c.button,"click",this.redo_click.closure(this))}damoUtil.addEvent(this.editor.editor,"keyup",this.editor_keyup.closureListener(this));damoUtil.addEvent(this.editor.editor,"keydown",this.editor_keydown.closureListener(this))};UndoManager.prototype.clearUndo=function(a){this.stack.clearUndo();this.startValue=a};UndoManager.prototype.changed=function(a){if(a.undoBtn){a.editor.buttonDisable(a.undoBtn,!a.stack.canUndo())}if(a.redoBtn){a.editor.buttonDisable(a.redoBtn,!a.stack.canRedo())}};UndoManager.prototype.undo_click=function(){this.startValue=this.stack.undo(this.editor)};UndoManager.prototype.redo_click=function(){this.stack.redo()};UndoManager.prototype.editor_keyup=function(a){if(this.isPressShortcuts){if(a.ctrlKey&&a.keyCode===86){this.record();return true}if(a.keyCode===17||a.ctrlKey||a.keyCode>86){return false}this.isPressShortcuts=false}clearTimeout(this.timer);this.timer=setTimeout(this.autoRecord.closure(this),300)};UndoManager.prototype.editor_keydown=function(a){if(a.ctrlKey){this.isPressShortcuts=true;switch(a.keyCode){case 89:a.preventDefault();if(this.stack.canRedo()){this.startValue=this.stack.redo()}break;case 90:a.preventDefault();if(this.stack.canUndo()){this.startValue=this.stack.undo(this.editor)}break}}};UndoManager.prototype.autoRecord=function(){var a=this.editor.editor.innerHTML;if(a!=this.startValue){this.stack.execute(new EditCommand(this.editor.editor,this.startValue,a));this.startValue=a}};UndoManager.prototype.record=function(){this.editor.focus();var a=this.editor.editor.innerHTML;this.stack.execute(new EditCommand(this.editor.editor,this.startValue,a));this.startValue=a};